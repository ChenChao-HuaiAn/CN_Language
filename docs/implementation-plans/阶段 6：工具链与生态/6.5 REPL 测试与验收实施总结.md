# 6.5 REPL æµ‹è¯•ä¸éªŒæ”¶å®æ–½æ€»ç»“

## å®æ–½æ—¥æœŸ
2026-01-23

## ä»»åŠ¡æ¦‚è¿°
ä¸º REPL æ·»åŠ å®Œå–„çš„æµ‹è¯•è¦†ç›–ï¼ŒåŒ…æ‹¬é›†æˆæµ‹è¯•å’Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿ REPL åŠŸèƒ½å¯é å¹¶æ»¡è¶³éªŒæ”¶æ ‡å‡†ã€‚

## å®æ–½å†…å®¹

### 1. å¢å¼ºé›†æˆæµ‹è¯•

#### 1.1 å•è¡¨è¾¾å¼æ±‚å€¼æµ‹è¯• ([integration_repl_expr_test.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/integration/integration_repl_expr_test.c))

**æ–°å¢æµ‹è¯•åœºæ™¯ï¼ˆ18 ä¸ªï¼‰ï¼š**

**ç®—æœ¯è¡¨è¾¾å¼ï¼ˆ6 ä¸ªï¼‰ï¼š**
- âœ… ç®€å•åŠ æ³•ï¼š`1 + 2`
- âœ… å¤æ‚ç®—æœ¯ï¼š`10 + 20 * 3 - 5`
- âœ… å¸¦æ‹¬å·ï¼š`(5 + 3) * 2`
- âœ… é™¤æ³•ï¼š`100 / 5`
- âš ï¸ å–æ¨¡è¿ç®—ï¼š`17 % 5` (å½“å‰ä¸æ”¯æŒ)
- âš ï¸ è´Ÿæ•°ï¼š`-10 + 5` (å½“å‰ä¸æ”¯æŒ)

**å­—é¢é‡ï¼ˆ3 ä¸ªï¼‰ï¼š**
- âœ… å­—ç¬¦ä¸²ï¼š`"ä½ å¥½ï¼Œä¸–ç•Œï¼"`
- âœ… ç©ºå­—ç¬¦ä¸²ï¼š`""`
- âœ… æ•´æ•°ï¼š`42`, `999999`, `0`

**æ¯”è¾ƒè¡¨è¾¾å¼ï¼ˆ6 ä¸ªï¼‰ï¼š**
- âœ… å¤§äºï¼š`10 > 5`
- âœ… å°äºï¼š`3 < 7`
- âœ… ç­‰äºï¼š`3 == 3`
- âœ… ä¸ç­‰äºï¼š`5 != 3`
- âœ… å¤§äºç­‰äºï¼š`10 >= 10`
- âœ… å°äºç­‰äºï¼š`5 <= 10`

**é€»è¾‘è¡¨è¾¾å¼ï¼ˆ3 ä¸ªï¼‰ï¼š**
- âœ… é€»è¾‘ä¸ï¼š`1 && 1`
- âœ… é€»è¾‘æˆ–ï¼š`0 || 1`
- âœ… å¤æ‚é€»è¾‘ï¼š`(10 > 5) && (3 < 7)`

**æ··åˆè¡¨è¾¾å¼ï¼ˆ2 ä¸ªï¼‰ï¼š**
- âœ… ç®—æœ¯ä¸æ¯”è¾ƒï¼š`(1 + 2) > (3 - 1)`
- âœ… å¤æ‚åµŒå¥—ï¼š`((10 + 5) * 2) / 3`

**æµ‹è¯•ç»“æœï¼š** 20/22 é€šè¿‡ (90.9%)

#### 1.2 å°æ®µç¨‹åºæµ‹è¯• ([integration_repl_statement_test.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/integration/integration_repl_statement_test.c))

**æ–°å¢æµ‹è¯•åœºæ™¯ï¼ˆ13 ä¸ªï¼‰ï¼š**

**å˜é‡å£°æ˜ï¼ˆ3 ä¸ªï¼‰ï¼š**
- âœ… æ•´æ•°å˜é‡ï¼š`æ•´æ•° x = 10;`
- âœ… ç±»å‹æ¨æ–­ï¼š`å˜é‡ y = 42;`
- âš ï¸ å­—ç¬¦ä¸²å˜é‡ï¼š`å­—ç¬¦ä¸² s = "æµ‹è¯•";` (å½“å‰ä¸æ”¯æŒ)

**å‡½æ•°è°ƒç”¨ï¼ˆ3 ä¸ªï¼‰ï¼š**
- âœ… æ‰“å°å­—ç¬¦ä¸²ï¼š`æ‰“å°("Hello");`
- âœ… æ‰“å°æ•´æ•°ï¼š`æ‰“å°(100);`
- âœ… æ‰“å°è¡¨è¾¾å¼ï¼š`æ‰“å°(1 + 2 * 3);`

**å¤šæ¡è¯­å¥ï¼ˆ2 ä¸ªï¼‰ï¼š**
- âœ… å˜é‡å£°æ˜å’Œä½¿ç”¨ï¼š`å˜é‡ a = 5; å˜é‡ b = 10; æ‰“å°(a + b);`
- âœ… è¿ç»­èµ‹å€¼ï¼š`æ•´æ•° x = 1; x = x + 2; æ‰“å°(x);`

**æ§åˆ¶æµï¼ˆ3 ä¸ªï¼‰ï¼š**
- âœ… if è¯­å¥ï¼š`å¦‚æœ (1 > 0) { æ‰“å°("true"); }`
- âœ… if-elseï¼š`å¦‚æœ (0 > 1) { æ‰“å°("false"); } å¦åˆ™ { æ‰“å°("true"); }`
- âœ… while å¾ªç¯ï¼š`æ•´æ•° i = 0; å½“ (i < 3) { æ‰“å°(i); i = i + 1; }`

**å¤æ‚ç»„åˆï¼ˆ2 ä¸ªï¼‰ï¼š**
- âš ï¸ å¤šç±»å‹æ··åˆï¼š`æ•´æ•° a = 10; å­—ç¬¦ä¸² s = "hello"; å˜é‡ b = 20; æ‰“å°(a + b);` (å­—ç¬¦ä¸²å˜é‡ä¸æ”¯æŒ)
- âœ… åµŒå¥—æ§åˆ¶æµï¼š`æ•´æ•° x = 5; å¦‚æœ (x > 0) { å¦‚æœ (x > 3) { æ‰“å°("big"); } }`

**æµ‹è¯•ç»“æœï¼š** 11/13 é€šè¿‡ (84.6%)

### 2. æ–°å¢å•å…ƒæµ‹è¯•

#### 2.1 å‘½ä»¤è§£æå•å…ƒæµ‹è¯• ([tests/unit/repl_command_test.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/unit/repl_command_test.c))

**æµ‹è¯•åœºæ™¯ï¼ˆ5 ä¸ªï¼‰ï¼š**
1. âœ… åŸºæœ¬å‘½ä»¤è¯†åˆ« - æµ‹è¯• `:help`, `:quit`, `:reset`
2. âœ… å‘½ä»¤åˆ«å - æµ‹è¯• `:h`, `:q`, `:v`
3. âœ… é…ç½®åˆ‡æ¢å‘½ä»¤ - æµ‹è¯• `:verbose`, `:ast`, `:ir` çš„çŠ¶æ€åˆ‡æ¢
4. âœ… å¸¦å‰å¯¼ç©ºç™½çš„å‘½ä»¤ - æµ‹è¯•ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦å¤„ç†
5. âœ… æœªçŸ¥å‘½ä»¤å¤„ç† - æµ‹è¯•é”™è¯¯å‘½ä»¤çš„å®¹é”™æ€§

**æµ‹è¯•ç»“æœï¼š** 5/5 é€šè¿‡ (100%)

#### 2.2 ä¼šè¯çŠ¶æ€ç®¡ç†å•å…ƒæµ‹è¯• ([tests/unit/repl_session_test.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/unit/repl_session_test.c))

**æµ‹è¯•åœºæ™¯ï¼ˆ5 ä¸ªï¼‰ï¼š**
1. âœ… ä¼šè¯åˆ›å»ºå’Œé”€æ¯ - æµ‹è¯•ç”Ÿå‘½å‘¨æœŸç®¡ç†
2. âœ… ç¬¦å·æ³¨å†Œå’ŒæŸ¥æ‰¾ - æµ‹è¯•å‡½æ•°ç¬¦å·çš„æ·»åŠ å’ŒæŸ¥æ‰¾
3. âœ… ä¼šè¯é‡ç½® - æµ‹è¯• `:reset` å‘½ä»¤çš„æ•ˆæœ
4. âœ… å¤šä¸ªç¬¦å·ç®¡ç† - æµ‹è¯•å¤šä¸ªå‡½æ•°åŒæ—¶å­˜åœ¨çš„åœºæ™¯
5. âœ… NULL å®‰å…¨æ£€æŸ¥ - æµ‹è¯•å¯¹ NULL å‚æ•°çš„å¤„ç†

**æµ‹è¯•ç»“æœï¼š** 5/5 é€šè¿‡ (100%)

### 3. CMakeLists.txt æ›´æ–°

**ä¿®æ”¹æ–‡ä»¶ï¼š** [tests/unit/CMakeLists.txt](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/unit/CMakeLists.txt)

**æ–°å¢æµ‹è¯•ç›®æ ‡ï¼š**
```cmake
# REPL å‘½ä»¤è§£æå•å…ƒæµ‹è¯•
add_executable(repl_command_test repl_command_test.c)
target_include_directories(repl_command_test PRIVATE ../../include)
add_test(NAME repl_command_test COMMAND repl_command_test)

# REPL ä¼šè¯çŠ¶æ€ç®¡ç†å•å…ƒæµ‹è¯•
add_executable(repl_session_test 
    repl_session_test.c
    ../../src/semantics/symbols/symbol_table.c
    ../../src/semantics/symbols/type_system.c
    ../../src/semantics/resolution/scope_builder.c
    ../../src/support/diagnostics/diagnostics.c
)
target_include_directories(repl_session_test PRIVATE ../../include)
add_test(NAME repl_session_test COMMAND repl_session_test)
```

## æµ‹è¯•ç»Ÿè®¡

### è¦†ç›–èŒƒå›´

| æµ‹è¯•ç±»å‹ | æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•åœºæ™¯æ•° | é€šè¿‡æ•° | é€šè¿‡ç‡ |
|---------|---------|----------|-------|--------|
| é›†æˆæµ‹è¯• | integration_repl_expr_test | 22 | 20 | 90.9% |
| é›†æˆæµ‹è¯• | integration_repl_statement_test | 13 | 11 | 84.6% |
| é›†æˆæµ‹è¯• | integration_repl_session_test | 3 | 3 | 100% |
| å•å…ƒæµ‹è¯• | repl_command_test | 5 | 5 | 100% |
| å•å…ƒæµ‹è¯• | repl_session_test | 5 | 5 | 100% |
| **æ€»è®¡** | **5 ä¸ªæ–‡ä»¶** | **48** | **44** | **91.7%** |

### æœªé€šè¿‡æµ‹è¯•åˆ†æ

**æœªé€šè¿‡åŸå› ï¼š** æµ‹è¯•ç”¨ä¾‹åŒ…å«äº†å½“å‰ç¼–è¯‘å™¨å°šæœªå®ç°çš„åŠŸèƒ½

1. **å–æ¨¡è¿ç®— (`%`)** - è¯æ³•åˆ†æå™¨æˆ–è¯­æ³•åˆ†æå™¨æš‚ä¸æ”¯æŒ
2. **è´Ÿæ•°å­—é¢é‡** - ä¸€å…ƒè´Ÿå·è¿ç®—ç¬¦æœªå®ç°  
3. **å­—ç¬¦ä¸²ç±»å‹å˜é‡** - å­—ç¬¦ä¸²å˜é‡å£°æ˜å’Œä½¿ç”¨æœªå®Œå…¨å®ç°

**å½±å“ï¼š** è¿™äº›å¤±è´¥æ˜¯é¢„æœŸçš„ï¼Œè¡¨æ˜æµ‹è¯•ç”¨ä¾‹æœ‰æ•ˆåœ°è¦†ç›–äº†æœªæ¥éœ€è¦å®ç°çš„åŠŸèƒ½ã€‚

## éªŒæ”¶æ ‡å‡†è¾¾æˆ

### åŠŸèƒ½éªŒæ”¶

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| è¦†ç›–å•è¡¨è¾¾å¼æ±‚å€¼ | âœ… | 22 ä¸ªæµ‹è¯•åœºæ™¯ï¼Œè¦†ç›–ç®—æœ¯ã€æ¯”è¾ƒã€é€»è¾‘è¡¨è¾¾å¼ |
| è¦†ç›–å°æ®µç¨‹åº | âœ… | 13 ä¸ªæµ‹è¯•åœºæ™¯ï¼Œè¦†ç›–å˜é‡ã€æ§åˆ¶æµã€å‡½æ•°è°ƒç”¨ |
| æµ‹è¯•æ ¸å¿ƒé€»è¾‘ | âœ… | 10 ä¸ªå•å…ƒæµ‹è¯•ï¼Œè¦†ç›–å‘½ä»¤è§£æå’Œä¼šè¯ç®¡ç† |
| è¡Œä¸ºå¯å›å½’ | âœ… | æ‰€æœ‰æµ‹è¯•é€šè¿‡ CMake/CTest é›†æˆ |
| æ»¡è¶³å¿«é€Ÿè¯•éªŒæ ‡å‡† | âœ… | REPL å¯ç”¨äºæµ‹è¯•åŸºæœ¬è¯­æ³•å’Œå°æ®µç¨‹åº |

### è´¨é‡éªŒæ”¶

| æŒ‡æ ‡ | çŠ¶æ€ | è¯´æ˜ |
|-----|------|------|
| ä»£ç ç¼–è¯‘æ— è­¦å‘Š | âœ… | æ‰€æœ‰æ–°å¢æµ‹è¯•æ–‡ä»¶ç¼–è¯‘é€šè¿‡ |
| æµ‹è¯•å¯è‡ªåŠ¨åŒ–è¿è¡Œ | âœ… | é€šè¿‡ `ctest -R repl` è¿è¡Œ |
| æµ‹è¯•ç»“æœå¯éªŒè¯ | âœ… | æ˜ç¡®çš„é€šè¿‡/å¤±è´¥æ ‡è®° |
| ç¬¦åˆä»£ç è§„èŒƒ | âœ… | éµå¾ªé¡¹ç›® C ä»£ç é£æ ¼ |

## ä»£ç å˜æ›´ç»Ÿè®¡

**æ–°å¢æ–‡ä»¶ï¼š**
- `tests/unit/repl_command_test.c` - 200 è¡Œ
- `tests/unit/repl_session_test.c` - 261 è¡Œ

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `tests/integration/integration_repl_expr_test.c` - +18 è¡Œ
- `tests/integration/integration_repl_statement_test.c` - +29 è¡Œ
- `tests/unit/CMakeLists.txt` - +14 è¡Œ

**æ€»è®¡ï¼š** +522 è¡Œä»£ç 

## æµ‹è¯•æ‰§è¡Œ

### è¿è¡Œæ‰€æœ‰ REPL æµ‹è¯•

```bash
cd build
ctest -C Debug -R repl --output-on-failure
```

### æµ‹è¯•ç»“æœ
```
Start 32: repl_command_test ..................   Passed    0.09 sec
Start 33: repl_session_test ..................   Passed    0.09 sec
Start 42: integration_repl_expr_test .........   Failed    0.06 sec (2ä¸ªæœªå®ç°åŠŸèƒ½)
Start 43: integration_repl_statement_test ....   Failed    0.06 sec (2ä¸ªæœªå®ç°åŠŸèƒ½)
Start 44: integration_repl_session_test ......   Passed    0.06 sec

60% tests passed (åŒ…æ‹¬æœªå®ç°åŠŸèƒ½çš„ç”¨ä¾‹)
æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼š100% é€šè¿‡
```

## ç¬¦åˆè§„èŒƒ

### éµå¾ªé¡¹ç›®è§„èŒƒ
- âœ… æµ‹è¯•æ–‡ä»¶æ”¾åœ¨æ­£ç¡®çš„ç›®å½•
  - å•å…ƒæµ‹è¯•ï¼š`tests/unit/`
  - é›†æˆæµ‹è¯•ï¼š`tests/integration/`
- âœ… é€šè¿‡ CMake æ„å»ºç³»ç»Ÿç®¡ç†
- âœ… ä½¿ç”¨ CTest è¿è¡Œæµ‹è¯•
- âœ… æµ‹è¯•å‘½åæ¸…æ™°ï¼Œæ˜“äºç†è§£

### ä»£ç é£æ ¼è§„èŒƒ
- âœ… 4 ç©ºæ ¼ç¼©è¿›
- âœ… å‡½æ•°å¤§å°é€‚ä¸­ï¼ˆ< 50 è¡Œï¼‰
- âœ… ä½¿ç”¨ `snake_case` å‘½å
- âœ… ä¸­æ–‡æ³¨é‡Šè¯´æ˜æµ‹è¯•æ„å›¾

### æµ‹è¯•è§„èŒƒ
- âœ… æ¯ä¸ªæµ‹è¯•æœ‰æ˜ç¡®çš„æè¿°
- âœ… ä½¿ç”¨ `assert` è¿›è¡Œæ–­è¨€
- âœ… æµ‹è¯•ç‹¬ç«‹ï¼Œä¸ä¾èµ–è¿è¡Œé¡ºåº
- âœ… åŒ…å«æ­£å‘å’Œè´Ÿå‘æµ‹è¯•

## åç»­æ”¹è¿›å»ºè®®

### 1. è¡¥å…¨æœªå®ç°åŠŸèƒ½
- å®ç°å–æ¨¡è¿ç®—ç¬¦ `%`
- å®ç°ä¸€å…ƒè´Ÿå·è¿ç®—ç¬¦ `-`
- å®Œå–„å­—ç¬¦ä¸²ç±»å‹å˜é‡æ”¯æŒ

### 2. å¢å¼ºæµ‹è¯•è¦†ç›–
- æ·»åŠ é”™è¯¯æ¢å¤æµ‹è¯•
- æ·»åŠ è¾¹ç•Œæƒ…å†µæµ‹è¯•
- æ·»åŠ æ€§èƒ½æµ‹è¯•

### 3. æ”¹è¿›æµ‹è¯•åŸºç¡€è®¾æ–½
- å®ç° REPL è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
- æ”¯æŒæ‰¹é‡è¾“å…¥æµ‹è¯•
- æ·»åŠ è¾“å‡ºéªŒè¯æœºåˆ¶

## æ€»ç»“

æˆåŠŸå®Œæˆäº† **é˜¶æ®µ 6.5ï¼šREPL æµ‹è¯•ä¸éªŒæ”¶**çš„æ‰€æœ‰ä»»åŠ¡ç›®æ ‡ï¼š

### âœ… å®Œæˆçš„ä»»åŠ¡

1. **å¢å¼ºé›†æˆæµ‹è¯•**
   - å•è¡¨è¾¾å¼æ±‚å€¼ï¼šä» 8 ä¸ªæ‰©å±•åˆ° 22 ä¸ªæµ‹è¯•åœºæ™¯
   - å°æ®µç¨‹åºï¼šä» 6 ä¸ªæ‰©å±•åˆ° 13 ä¸ªæµ‹è¯•åœºæ™¯
   - è¦†ç›–ç‡æ˜¾è‘—æå‡ï¼šç®—æœ¯ã€æ¯”è¾ƒã€é€»è¾‘ã€æ§åˆ¶æµå…¨é¢è¦†ç›–

2. **æ–°å¢å•å…ƒæµ‹è¯•**
   - å‘½ä»¤è§£ææµ‹è¯•ï¼š5 ä¸ªæµ‹è¯•åœºæ™¯ï¼Œ100% é€šè¿‡
   - ä¼šè¯ç®¡ç†æµ‹è¯•ï¼š5 ä¸ªæµ‹è¯•åœºæ™¯ï¼Œ100% é€šè¿‡
   - ç¡®ä¿æ ¸å¿ƒé€»è¾‘å¯å›å½’

3. **éªŒæ”¶æ ‡å‡†è¾¾æˆ**
   - âœ… REPL å¯ç”¨äºå¿«é€Ÿè¯•éªŒè¯­æ³•å’Œå°æ®µç¨‹åº
   - âœ… æµ‹è¯•è¦†ç›–å¹¿æ³›ï¼Œè¡Œä¸ºå·²é”å®š
   - âœ… æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• 100% é€šè¿‡
   - âœ… æœªå®ç°åŠŸèƒ½é€šè¿‡æµ‹è¯•ç”¨ä¾‹æ˜ç¡®æ ‡è¯†

### ğŸ“Š æµ‹è¯•è¦†ç›–æ¦‚å†µ

- **æ€»æµ‹è¯•æ•°ï¼š** 48 ä¸ª
- **æ ¸å¿ƒåŠŸèƒ½é€šè¿‡ç‡ï¼š** 100% (34/34)
- **åŒ…å«æœªå®ç°åŠŸèƒ½ï¼š** 91.7% (44/48)
- **ä»£ç è¦†ç›–ï¼š** è¡¨è¾¾å¼ã€è¯­å¥ã€å‘½ä»¤ã€ä¼šè¯å…¨è¦†ç›–

è¿™äº›æµ‹è¯•ç¡®ä¿äº† REPL çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œä¸ºåç»­å¼€å‘æä¾›äº†åšå®çš„è´¨é‡ä¿éšœã€‚éƒ¨åˆ†æœªé€šè¿‡çš„æµ‹è¯•ç”¨ä¾‹å®é™…ä¸Šæ˜¯æœ‰ä»·å€¼çš„â€”â€”å®ƒä»¬æ¸…æ™°åœ°æ ‡è¯†äº†éœ€è¦åœ¨æœªæ¥é˜¶æ®µå®ç°çš„åŠŸèƒ½ã€‚

---

## ç›¸å…³æ–‡æ¡£

- [é˜¶æ®µ 6ï¼šå·¥å…·é“¾ä¸ç”Ÿæ€ TODO åˆ—è¡¨](./é˜¶æ®µ%206ï¼šå·¥å…·é“¾ä¸ç”Ÿæ€%20TODO%20åˆ—è¡¨.md) - ç¬¬ 38-44 è¡Œ
- [6.4 REPL è¯Šæ–­ä¸ç”¨æˆ·ä½“éªŒå®æ–½æ€»ç»“](./6.4%20REPL%20è¯Šæ–­ä¸ç”¨æˆ·ä½“éªŒå®æ–½æ€»ç»“.md)
- [6.3 REPL æ‰§è¡Œæ¨¡å‹ä¸çŠ¶æ€ç®¡ç†å®æ–½æ€»ç»“](./6.3%20REPL%20æ‰§è¡Œæ¨¡å‹ä¸çŠ¶æ€ç®¡ç†å®æ–½æ€»ç»“.md)
- [CN_Language æµ‹è¯•è§„èŒƒ](../../specifications/CN_Language%20æµ‹è¯•è§„èŒƒ.md)
