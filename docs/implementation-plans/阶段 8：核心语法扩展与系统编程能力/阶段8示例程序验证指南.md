# 阶段8示例程序验证指南

本指南说明如何验证新创建的4个系统编程示例程序的有效性。

## 验证层次

### 1. 静态验证（不需要编译器支持）

#### 1.1 文件完整性检查
```bash
# 检查文件是否存在
ls -la examples/memory_manager_demo.cn
ls -la examples/task_scheduler_demo.cn
ls -la examples/device_driver_demo.cn
ls -la examples/syntax_verification_test.cn

# 检查文件大小（应该都大于0）
du -h examples/memory_manager_demo.cn
du -h examples/task_scheduler_demo.cn
du -h examples/device_driver_demo.cn
du -h examples/syntax_verification_test.cn
```

#### 1.2 UTF-8编码验证
```bash
# 检查文件编码
file -i examples/memory_manager_demo.cn
# 应该输出: text/plain; charset=utf-8

# 检查是否包含中文字符
grep -P "[\x{4e00}-\x{9fff}]" examples/memory_manager_demo.cn | head -5
```

#### 1.3 语法结构检查
```bash
# 检查基本语法元素
grep "函数 " examples/memory_manager_demo.cn | head -10
grep "结构体 " examples/task_scheduler_demo.cn
grep "枚举 " examples/device_driver_demo.cn
grep "模块 " examples/syntax_verification_test.cn
```

### 2. 词法分析验证

#### 2.1 手动词法检查
查看文件是否包含正确的CN语言关键字：
- ✓ 函数、返回、变量
- ✓ 整数、小数、字符串、布尔
- ✓ 如果、否则、当、循环
- ✓ 结构体、枚举、模块
- ✓ 打印、公开、私有

#### 2.2 使用测试程序验证
```bash
# 编译测试程序
cmake --build build --target phase8_examples_validation_test

# 运行验证测试
ctest -R phase8_examples_validation_test -V
```

预期输出：
```
================================================
  阶段8系统编程示例程序验收测试
================================================

=== 验证: examples/memory_manager_demo.cn ===
  [文件检查] 大小: XXXX 字节
  ✓ 文件包含中文字符（UTF-8编码）
  [词法分析] examples/memory_manager_demo.cn...
    ✓ 词法分析通过 (共XXXX个Token)
  [语法分析] examples/memory_manager_demo.cn...
    ✓ 语法分析通过 (函数:XX, 语句:XX)
  ✓✓✓ examples/memory_manager_demo.cn 验证通过 ✓✓✓

... (其他3个文件的验证输出)

================================================
  验证总结
================================================
总共: 4 个示例
通过: 4 个
失败: 0 个
成功率: 100.0%

✓✓✓ 所有示例验证通过！✓✓✓
阶段8系统编程能力示例程序质量合格！
================================================
```

### 3. 语法分析验证

#### 3.1 AST结构验证
验证测试会检查：
- 函数声明数量
- 语句数量
- 无语法错误

#### 3.2 结构完整性
每个示例应包含：
- ✓ 主程序函数（函数 主程序()）
- ✓ 辅助函数定义
- ✓ 数据结构定义
- ✓ 演示场景函数

### 4. 语义验证（未来支持）

当语义分析器完善后，可以验证：
- 类型检查正确性
- 符号解析正确性
- 作用域规则遵守
- 函数调用匹配

### 5. 端到端验证（未来支持）

当编译器完整支持后：
```bash
# 编译CN文件到C代码
./build/cnc examples/memory_manager_demo.cn -o output.c

# 编译C代码
gcc output.c -o memory_demo

# 运行
./memory_demo
```

## 快速验证步骤

### 方案A：使用自动化测试（推荐）

```bash
# 1. 配置项目
cmake -B build

# 2. 编译测试
cmake --build build --target phase8_examples_validation_test

# 3. 运行验证（仅验证阶段8示例）
cd build
ctest -R phase8_examples_validation_test --output-on-failure

# 4. 查看详细输出
ctest -R phase8_examples_validation_test -V
```

### 方案B：使用现有测试工具

```bash
# 使用词法分析器测试
cmake --build build --target lexer_token_test
./build/tests/unit/lexer_token_test

# 使用解析器测试
cmake --build build --target parser_minimal_test
./build/tests/unit/parser_minimal_test
```

### 方案C：手动验证

```bash
# 1. 检查文件存在性和大小
ls -lh examples/*_demo.cn examples/syntax_verification_test.cn

# 2. 检查UTF-8编码
file examples/*.cn

# 3. 统计代码行数
wc -l examples/memory_manager_demo.cn
wc -l examples/task_scheduler_demo.cn
wc -l examples/device_driver_demo.cn
wc -l examples/syntax_verification_test.cn

# 4. 检查关键语法元素
grep -c "函数 " examples/memory_manager_demo.cn
grep -c "结构体 " examples/task_scheduler_demo.cn
grep -c "枚举 " examples/device_driver_demo.cn
```

## 验证标准

### ✓ 合格标准

1. **文件完整性**
   - 所有4个文件都存在
   - 文件大小合理（每个 > 10KB）
   - UTF-8编码正确

2. **词法分析**
   - 无词法错误
   - 所有Token正确识别
   - 中文关键字正确解析

3. **语法分析**
   - 无语法错误
   - AST结构完整
   - 函数声明正确解析

4. **代码质量**
   - 注释清晰完整
   - 结构层次分明
   - 演示场景丰富

### ✗ 不合格标准

- 文件缺失或为空
- 编码错误（非UTF-8）
- 存在词法或语法错误
- 缺少必要的函数或结构

## 故障排查

### 问题1：测试编译失败
```bash
# 检查依赖
cmake --build build --target cn_lexer
cmake --build build --target cn_parser

# 重新配置
rm -rf build
cmake -B build
cmake --build build
```

### 问题2：找不到示例文件
```bash
# 确认工作目录
pwd
# 应该在项目根目录

# 检查文件路径
ls examples/*.cn
```

### 问题3：词法分析报错
- 检查文件编码是否为UTF-8
- 检查是否有非法字符
- 检查中文关键字拼写

## 验证结果解读

### 成功输出示例
```
✓ 文件包含中文字符（UTF-8编码）
✓ 词法分析通过 (共5234个Token)
✓ 语法分析通过 (函数:15, 语句:120)
✓✓✓ examples/memory_manager_demo.cn 验证通过 ✓✓✓
```

### 失败输出示例
```
✗ 词法错误 (行42:15): 未识别的字符
✗ 发现3个词法错误
✗ 语法分析失败 (错误:2)
✗✗✗ examples/test.cn 验证失败 ✗✗✗
```

## 附加验证

### 代码统计
```bash
# 总代码行数
find examples -name "*_demo.cn" -o -name "syntax_verification_test.cn" | xargs wc -l

# 函数数量
grep -h "^函数 " examples/*_demo.cn examples/syntax_verification_test.cn | wc -l

# 注释密度
grep -c "^//" examples/memory_manager_demo.cn
```

### 预期统计结果
- memory_manager_demo.cn: ~393行，~10个函数
- task_scheduler_demo.cn: ~501行，~15个函数
- device_driver_demo.cn: ~550行，~15个函数
- syntax_verification_test.cn: ~474行，~15个函数
- **总计**: ~1,918行代码

## 总结

遵循本指南的验证步骤，可以全面确保阶段8示例程序的质量和有效性。推荐使用自动化测试工具进行验证，既快速又准确。
