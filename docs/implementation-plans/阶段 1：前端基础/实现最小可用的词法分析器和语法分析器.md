### 更具体的 TODO 列表（围绕 66–88 行内容）

我按“文档 → 词法 → 语法 → 诊断 → 测试”的顺序，拆成可以逐个完成的任务。

---

### A. 最小语言子集定义（文档侧）

- **A1 定义最小语言子集功能点**
  - 列出 v0 版本必须支持的语法元素：  
    - 变量声明：整型变量（例如：`整数 a = 1；` 或相应 CN_Language 语法）。  
    - 表达式：整型算术（`+ - * /`、括号）。  
    - 函数：简单函数定义（含入口函数）和函数调用。  
  - 明确目前**不支持**的特性（结构体、数组、模块系统等），防止范围失控。

- **A2 在语言规范文档中写出子集**
  - 打开 `docs/specifications/language_spec_draft.md`。  
  - 新增或补充“**最小可编译子集**”章节，内容包括：
    - 语法 BNF/EBNF 或接近自然语言的形式描述。  
    - 关键字列表（含中文关键字的写法）。  
    - 一个完整“hello world”风格的合法样例代码，对应 `examples/hello_world.cn`。

---

### B. 词法分析器（Lexer）

- **B1 设计 Token 集合**
  - 列出所有需要的 Token 类型：标识符、整数常量、关键字、运算符、括号、分号、逗号、EOF 等。  
  - 标记哪些是**中文关键字**、哪些是普通标识符（支持中文/英文/下划线组合）。

- **B2 设计词法模块结构**
  - 决定文件拆分（示例）：  
    - `token.h / token.c`：Token 类型定义、打印/调试辅助函数。  
    - `lexer.h / lexer.c`：词法状态机、接口 `next_token()` 等。  
    - `lexer_error.h / lexer_error.c`（可选）：词法层错误封装。
  - 确保每个 `.c` 文件和单个函数的行数控制在合理范围内（符合项目约束）。

- **B3 实现基础扫描逻辑**
  - 支持：  
    - 跳过空白、换行、制表符。  
    - 识别整数常量。  
    - 识别标识符，并根据关键字表区分是否为关键字（包括中文关键字）。  
    - 识别运算符和分隔符：`+ - * / = ( ) { } ; ,` 等。  
  - 处理遇到非法字符时的行为：  
    - 生成诊断信息（占位）并尝试跳过，继续扫描。

- **B4 与诊断接口对接（占位）**
  - 为词法错误调用统一诊断接口（例如 `report_error_lex(...)`），即使诊断模块还只是 stub，也先预留调用点。

---

### C. 语法分析器与 AST（Parser + AST）

- **C1 设计 AST 结构**
  - 在头文件中定义核心 AST 节点：  
    - Program（顶层）  
    - FunctionDecl  
    - VarDecl  
    - BlockStmt / ExprStmt  
    - 各类 Expr（BinaryExpr、CallExpr、IdentifierExpr、IntegerLiteral 等）  
  - 约定节点的内存管理策略（创建/销毁函数）。

- **C2 选择解析接口形式**
  - 确定对外接口（示例）：  
    - `parse_program(Lexer *lexer, AST_Program **out_program, Diagnostics *diag)`  
  - 定义 Parser 内部上下文结构（当前 Token、错误计数等）。

- **C3 实现递归下降解析函数**
  - 依据 A2 的“最小子集”语法，分别实现：  
    - `parse_program`：解析一组函数定义。  
    - `parse_function_decl`：函数头 + 参数列表（可先只支持无参或简单参数）+ 函数体。  
    - `parse_statement`：变量声明语句、表达式语句、块语句。  
    - `parse_expression`：实现带优先级的表达式（加减、乘除、括号）。  
  - 在发生语法错误时，使用诊断接口，并做基本的错误恢复（例如跳到下一个分号或右花括号）。

---

### D. 诊断与错误恢复模块

- **D1 设计诊断数据结构**
  - 定义 `Diagnostic` 结构：包含  
    - 严重性（错误/警告）、错误码、消息文本。  
    - 源位置信息（文件名、行列号）。  

- **D2 诊断接口实现**
  - 在类似 `support/diagnostics` 模块中提供接口：  
    - `report_error(...)` / `report_warning(...)`。  
    - 可选：收集到一个列表中，供调用方统一打印。  

- **D3 前端接入诊断模块**
  - Lexer 和 Parser 在遇到问题时调用诊断接口，而不是直接打印到 stdout/stderr。  
  - 确保解析完成后可以输出所有收集到的诊断信息。

---

### E. 单元测试（Unit Tests）

> 对应开发计划中的：`tests/unit/frontend/` 下有覆盖核心 Token / 语法规则的单元测试。

- **E1 词法单元测试**
  - 在 `tests/unit/` 下规划或新建 `frontend` 相关测试文件（比如 `lexer_tests.c`）。  
  - 为以下场景写测试：
    - 简单表达式：`1 + 2 * 3` 的 Token 序列是否正确。  
    - 含中文关键字的语句：例如变量声明、函数定义的 Token 序列。  
    - 非法字符的处理（是否生成诊断）。

- **E2 语法单元测试**
  - 为典型语句和表达式写 Parser 测试：  
    - 单个函数定义是否能构造出正确的 AST 结构。  
    - 简单表达式语法树结构是否符合预期（比如运算优先级）。  
    - 语法错误（缺少分号、括号不匹配等）是否被诊断出来。

---

### F. 集成测试（Integration Tests）

> 对应：`tests/integration/compiler/` 中存在至少一个“解析通过/失败”的集成测试。

- **F1 正常解析样例**
  - 选用或稍微简化 `examples/hello_world.cn`：
    - 写一个集成测试：运行前端对该文件进行解析，断言“无致命错误 + 生成 Program AST”。

- **F2 解析失败样例**
  - 制作一个带明显语法错误的 `.cn` 文件（如缺失大括号，或乱写关键字）。  
  - 写集成测试：  
    - 断言解析失败，诊断中包含至少一条语法错误。  

---
