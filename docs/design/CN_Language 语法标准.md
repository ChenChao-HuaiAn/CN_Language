# CN_Language 语法标准（项目内部约定版）

> 本文是 **CN 语言在本项目中使用的语法约定标准**，用于约束 `*.cn` 源文件的编写形式。
> 语法定义 **以《docs/specifications/CN_Language 语言规范草案（核心子集）.md》为最终权威**，本标准在其基础上给出更具体的书写要求和推荐风格。
> 若两者出现不一致，应以语言规范草案为准，并同步修订本文件。

## 1. 适用范围与原则

1. 本标准适用于本仓库内 **所有 `.cn` 源文件**（示例、测试、工具代码等）。
2. 所有 `.cn` 文件必须满足：
   - 能被当前版本 CN 编译器正确解析；
   - 不使用语言规范中标记为「预留」「未来扩展」但尚未实现的特性；
   - 遵守下文对变量、函数、结构体等语法的约定形式。
3. 源码中涉及语法边界测试（如错误示例），必须在文件/用例说明中显式标注「此例为错误用例」。

## 2. 源文件与基本约定

1. **文件扩展名**：统一使用 `.cn`，且文件名建议使用有意义的中文或英文。
2. **编码**：统一使用 UTF-8（无 BOM），以支持中文标识符和字符串。
3. **行结束符**：建议使用 `\n`，文件末尾保留一个换行符。
4. **入口约定**：可执行程序应包含一个入口函数：

   ```cn
   函数 主程序() {
       // ...
       返回 0;
   }
   ```

5. **注释**：
   - 单行注释：`// 注释内容`
   - 多行注释：`/* 注释内容 */`

## 3. 标识符与关键字

1. **标识符组成**：
   - 允许使用中文、Unicode 字母、数字（首字符不得为数字）和下划线 `_`；
   - 标识符区分大小写；
   - 不得与任何关键字同名。
2. **典型关键字（当前项目常用子集）**：
   - 类型相关：`整数`、`小数`、`布尔`、`字符串`、`数组`、`结构体`；
   - 变量与声明：`变量`；
   - 函数与控制：`函数`、`返回`、`主程序`、`如果`、`否则`、`当`、`循环`；
   - 模块相关：`模块`、`导入`（当前使用较少，可按规范草案中的形式书写）。
3. **预留关键字**（如 `类`、`接口` 等）在项目当前阶段禁止作为任何语法结构或标识符使用。

## 4. 变量声明与使用

### 4.1 基本形式

1. **显式类型声明**：

   ```cn
   整数 年龄 = 30;
   小数 比例 = 0.5;
   布尔 已完成 = 真;
   字符串 姓名 = "张三";
   ```

2. **使用 `变量` 进行类型推断**：

   ```cn
   变量 计数 = 0;           // 推断为整数
   变量 消息 = "你好";     // 推断为字符串
   变量 值列表 = [1, 2, 3]; // 推断为数组 整数
   ```

3. **数组声明**：

   ```cn
    // 方式1：指定大小并初始化
    整数 arr1[5] = {1, 2, 3, 4, 5};
    
    // 方式2：不指定大小，编译器自动计算
    变量 arr2[] = {10, 20, 30};
    
    // 方式3：部分初始化，剩余元素自动为0
    整数 arr3[10] = {1, 2, 3};
    
    // 方式4：全部初始化为0
    整数 arr4[100] = {0};
    
    // 不同类型的数组
    小数 scores[5] = {85.5, 90.0, 78.5, 92.5, 88.0};
    字符串 names[3] = {"张三", "李四", "王五"};
    
    // 数组访问
    变量 first = arr1[0];   // 访问第一个元素
    变量 third = arr1[2];   // 访问第三个元素
    
    // 数组修改
    arr1[1] = 25;            // 修改第二个元素
    arr1[4] = 100;           // 修改最后一个元素
    
   ```

### 4.2 变量命名与作用域

1. 变量名应语义清晰，避免使用 `a1`、`tmp2` 等无含义名称（循环索引 `i/j/k` 等简单场景除外）。
2. 局部变量应声明在首次使用前，尽量靠近使用点：

   ```cn
   函数 示例() {
       整数 结果 = 0;
       // 使用 结果
       返回 结果;
   }
   ```

3. 禁止在同一作用域内重复声明同名变量。

### 4.3 赋值与表达式

1. 使用 `=` 进行赋值：

   ```cn
   变量 i = 0;
   i = i + 1;
   ```

2. 表达式运算遵循语言规范草案中的定义：
   - 算术：`+`、`-`、`*`、`/`、`%`；
   - 比较：`==`、`!=`、`<`、`<=`、`>`、`>=`；
   - 逻辑：`&&`、`||`、`!`。
3. 条件和循环中的条件表达式必须求值为布尔类型。

### 4.4 常量变量声明

1. 使用 `常量` 关键字可以声明**一旦初始化后不能再被赋值的变量**：

   ```cn
   常量 整数 最大值 = 100;
   常量 字符串 应用名称 = "CN_Language";
   ```

2. `常量` 可以与 `变量` 关键字配合，用于类型推断的只读变量：

   ```cn
   常量 变量 文本 = "只读字符串";
   常量 变量 数量 = 1 + 2;
   ```

3. 对常量变量的再次赋值在语义检查阶段会被视为错误，例如：

   ```cn
   常量 整数 a = 1;
   a = 2;  // 不允许：编译器会报“不能给常量变量赋值”
   ```

4. 建议：
   - 对于配置、阈值、常量表达式结果等不应在运行期改变的值，应优先使用 `常量` 声明；
   - 在示例与测试代码中也尽量保持与实现语义一致，不滥用可变变量。

## 5. 函数声明、定义与调用

### 5.1 函数声明与定义形式

1. **标准形式**：

   ```cn
   函数 函数名(参数列表) {
       // 函数体
   }
   ```

2. **示例**：

   ```cn
   函数 加法(整数 左, 整数 右) {
       返回 左 + 右;
   }

   函数 求平均值(小数 总和, 整数 数量) {
       返回 总和 / 数量;
   }
   ```

3. **返回类型约定**：

   - 函数声明中不写返回类型；
   - 返回值类型由函数体中的 `返回` 语句推断；
   - 如果函数体中没有任何 `返回` 语句，则默认返回类型为 `空`（空类型）。

### 5.2 参数与返回

1. 参数声明形式：`类型 名称`，多个参数使用逗号分隔：

   ```cn
   函数 取最大值(整数 a, 整数 b) {
       如果 (a > b) {
           返回 a;
       } 否则 {
           返回 b;
       }
   }
   ```

2. 使用 `返回 表达式;` 返回值，`返回` 语句必须位于函数体内部。
3. 同一函数中应避免出现「既有返回值路径又存在不返回的路径」的情况。

### 5.3 主程序入口函数

1. 可执行程序的入口函数约定为：

   ```cn
   函数 主程序() {
       // 程序入口逻辑
       返回 0;
   }
   ```

2. 编译器会将 `主程序` 映射为 C 语言的 `main` 函数，返回值应为整数。

### 5.4 函数调用

1. 基本调用形式：

   ```cn
   函数 加法(整数 左, 整数 右) {
       返回 左 + 右;
   }

   函数 主程序() {
       整数 结果 = 加法(1, 2);
       打印("结果: ");
       // 假设 打印整数 为内建函数示例
       打印整数(结果);
       返回 0;
   }
   ```

2. 对内建函数（如 `打印`、数组操作等），统一按 **函数调用语法** 书写：`函数名(参数列表)`。

## 6. 结构体定义与使用

### 6.1 结构体定义

1. 结构体类型定义形式：

   ```cn
   结构体 点 {
       整数 x;
       整数 y;
   }

   结构体 矩形 {
       整数 宽度;
       整数 高度;
   }
   ```

2. 字段声明统一使用 `类型 字段名;` 的形式，每个字段一行。
3. 结构体名称应使用中文或清晰的拼音词，表示具体含义（如 `点`、`矩形`、`配置项`）。

### 6.2 结构体变量与初始化

1. 声明结构体变量：

   ```cn
   结构体 点 {
       整数 x;
       整数 y;
   }

   函数 主程序() {
       点 起点;
       起点.x = 0;
       起点.y = 0;
       返回 0;
   }
   ```

2. 推荐使用结构体字面量进行初始化（当实现已支持时）：

   ```cn
   点 终点 = 点 { x: 100, y: 200 };
   ```

### 6.3 成员访问

1. 使用 `.` 运算符访问结构体变量成员：

   ```cn
   点 p;
   p.x = 10;
   p.y = 20;
   ```

2. 对指向结构体的指针，若实现支持，可使用 `->` 运算符：

   ```cn
   整数* 指针; // 示例，仅说明语法形式
   // 结构体 指针使用 "->" 访问成员：
   // 矩形* 矩形指针 = ...;
   // 矩形指针->宽度 = 100;
   ```

## 7. 控制流语句

### 7.1 条件语句

1. `如果/否则` 语句基本形式：

   ```cn
   如果 (条件) {
       // 分支1
   } 否则 {
       // 分支2
   }
   ```

2. 仅有 `如果` 而无 `否则` 的形式同样允许：

   ```cn
   如果 (条件) {
       // 只在条件为真时执行
   }
   ```

3. 条件表达式必须为布尔类型或能被语义系统接受为布尔条件。

### 7.2 循环语句

1. `当`（类似 `while`）的形式：

   ```cn
   变量 i = 0;
   当 (i < 10) {
       i = i + 1;
   }
   ```

2. 若使用 `循环`（类似 `for`）语法，应保持与语言规范草案中描述的一致形式。

   ```cn
   循环 (变量 i = 0; i < arr.length(), i++){
        ...
   }
   
## 8. 模块与文件组织（如使用时）

> 注：模块系统在当前项目中使用较少，本节仅在需要时参考；如未来模块使用增多，应补充更详细的规范。

1. 模块定义形式：

   ```cn
   模块 数学工具 {
       函数 整数 加(整数 a, 整数 b) {
           返回 a + b;
       }

       整数 圆周率近似值 = 3;
   }
   ```

2. 导入模块：

   ```cn
   导入 数学工具;

   函数 主程序() {
       整数 结果 = 数学工具.加(1, 2);
       返回 0;
   }
   ```

3. 模块名与文件名建议保持一致或具有明显关联，方便定位。

## 9. 项目内 `.cn` 文件的合规要求

1. 本仓库中的所有 `.cn` 文件（示例、单元测试、集成测试、系统测试等）应遵守本语法标准：
   - 变量声明统一采用本文件约定的显式类型/推断形式；
   - 函数声明、定义与调用符合第 5 节的形式；
   - 结构体的定义与使用符合第 6 节的形式；
   - 控制流、模块等语法在使用时参照相应章节。
2. 若为了测试编译错误或语义错误而故意编写「非法语法」或「不合规语法」，必须在文件顶端或相应用例附近添加中文注释，说明这是错误/异常用例，避免被误认为正常代码：

   ```cn
   // 本文件用于测试语法错误：缺少分号
   函数 主程序() {
       整数 a = 1  // 故意缺少分号
       返回 0;
   }
   ```

3. 未来若语言规范草案更新导致语法形态变化，应同步修订本文件，并逐步迁移仓库内 `.cn` 源文件以保持一致性。
