# CN_Language CN代码风格规范（首版）

> 本规范适用于使用 **CN_Language 语言** 编写的应用程序代码、示例代码及测试代码。
> 目标是：统一风格、提升可读性、符合中文语义化编程的设计理念。

## 1. 基本约束

1. **实现语言**：
   - 使用 CN_Language 语言，遵循 `CN_Language 语言规范草案（核心子集）.md` 的语法规则。

2. **文件/函数大小约束**（必须严格遵守）：
   - 每个 `.cn` 文件 **不超过 500 行**（含空行和注释）。
   - 每个函数 **不超过 50 行**（含空行和注释）。
   - 当超过上述限制时：
     - 优先拆分为多个更小的函数；
     - 如仍过大，则拆分为多个模块文件，使用模块系统组织代码。

3. **模块组织原则**：
   - 使用 `模块 模块名 { ... }` 定义独立的逻辑单元；
   - 模块内部的私有函数和变量不对外暴露（默认私有）；
   - 需要对外暴露的成员使用 `公开` 关键字标记；
   - 跨模块调用通过 `导入` 语句引入依赖模块。

4. **中文语义化编程**：
   - 优先使用有意义的中文标识符，避免使用拼音缩写；
   - 代码应当读起来接近自然语言的语义表达。

## 2. 文件与命名规范

### 2.1 文件组织

1. **源文件布局**：
   - 一个源文件主要负责一个相对独立的功能模块（例如：`学生管理.cn`、`数学工具.cn`）。
   - 禁止出现"杂烩文件"（同时包含完全不相关的业务逻辑）。

2. **模块文件对应关系**：
   - 按业务功能划分模块：
     - 数据模型：`模型/学生.cn`、`模型/课程.cn`
     - 业务逻辑：`业务/成绩管理.cn`、`业务/考勤管理.cn`
     - 工具函数：`工具/数学.cn`、`工具/字符串.cn`
     - 系统功能：`系统/内存.cn`、`系统/IO.cn`

### 2.2 文件命名

1. **CN 源文件**：
   - 使用中文 + 下划线命名：
     - 例如：`学生管理.cn`、`数学工具.cn`、`字符串处理.cn`。
   - 文件名应体现其职责范围，不使用含糊名称：
     - 推荐：`圆形计算.cn`、`用户认证.cn`；
     - 不推荐：`工具.cn`、`其他.cn`。

2. **模块命名**：
   - 模块名使用简洁的中文名词或名词短语：
     - 例如：`数学`、`学生管理`、`字符串工具`；
   - 避免过长的模块名（建议不超过 6 个汉字）。

## 3. 代码风格

### 3.1 缩进与空白

1. **缩进**：
   - 使用 **4 个空格** 作为缩进，不使用制表符（Tab）。

2. **行宽**：
   - 推荐每行不超过 **80 列**（中文字符按 2 列计算）；
   - 超出时优先通过拆分表达式或抽取辅助函数解决。

3. **空行使用**：
   - 函数之间用 1 行空行分隔；
   - 逻辑块之间可以使用空行提高可读性，但避免连续多个空行；
   - 模块定义前后使用空行分隔。

### 3.2 括号与大括号

1. **函数定义**：

   ```cn
   函数 Fuc_求圆的面积(变量 float_半径) -> 小数
   {
       // 函数体
   }
   ```

   - 左大括号单独一行，与函数名同缩进层级。

2. **控制语句**（`如果/否则/循环/当` 等）：

   ```cn
   如果 (条件) {
       // 语句体
   } 否则 {
       // 语句体
   }
   ```

   - 即使只有一条语句，也必须使用大括号，避免歧义。

3. **条件表达式**：
   - 条件应始终使用括号括起：`如果 (x == 0)`。

### 3.3 空格规则

- 关键字后加空格：`如果 (条件)`、`循环 (条件)`；
- 运算符两侧加空格：`a + b`、`a * b`、`a && b`；
- 函数调用不在函数名和左括号之间加空格：`Fuc_求和(x, y)`；
- 逗号后必须有空格：`Fuc_处理(a, b, c)`。

## 4. 命名约定

### 4.1 变量命名规范

**格式**：`[类型前缀]_[描述性名称]`

#### 4.1.1 类型前缀对照表

| 类型       | 前缀      | 示例                                    |
|------------|-----------|----------------------------------------|
| 整数       | `int`     | `int_长度`、`int_年龄`                 |
| 小数       | `float`   | `float_圆周率`、`float_速度`           |
| 字符串     | `str`     | `str_名字`、`str_路径`                 |
| 布尔       | `bool`    | `bool_已初始化`、`bool_登录`           |
| 字符       | `char`    | `char_首字符`、`char_标记`             |
| 指针       | `ptr`     | `ptr_缓冲区`、`ptr_数据`               |
| 数组       | `arr`     | `arr_成绩列表`、`arr_矩阵`             |
| 结构体     | `struct`  | `struct_信息`、`struct_数据`           |
| 枚举       | `enum`    | `enum_类型`、`enum_值`                 |

#### 4.1.2 命名示例

```cn
// 基本类型变量
变量 int_长度 = 10;
变量 float_圆周率 = 3.14159;
变量 str_名字 = "张三";
变量 bool_已启动 = 真;

// 数组变量
变量 arr_成绩[10];

// 结构体变量
变量 struct_信息 info;
```

#### 4.1.3 变量命名原则

1. **描述性名称**：
   - 使用准确描述变量用途的中文词汇；
   - 避免过于笼统的名称，如 `数据`、`值`、`信息`；
   - 推荐：`int_三角形边长`、`str_电子邮箱`；
   - 不推荐：`int_数据`、`str_信息`。

2. **特殊情况**：
   - 循环计数器可使用简化命名：`int_i`、`int_j`；
   - 临时变量可使用 `temp` 后缀：`int_计数器_temp`、`str_缓存_temp`。

### 4.2 函数命名规范

**格式**：`Fuc_[描述性名称]`

#### 4.2.1 命名示例

```cn
// 数学计算函数
函数 Fuc_求圆的面积(变量 float_半径) -> 小数
{
    返回 3.14159 * float_半径 * float_半径;
}

// 学生管理函数
函数 Fuc_添加学生(变量 str_名字, 变量 int_年龄) -> 布尔
{
    // 实现代码
}

// 字符串处理函数
函数 Fuc_连接(变量 str_左侧, 变量 str_右侧) -> 字符串
{
    // 实现代码
}

// 系统功能函数
函数 Fuc_初始化() -> 空
{
    // 实现代码
}
```

#### 4.2.2 函数命名原则

1. **统一前缀**：
   - 所有函数名必须以 `Fuc_` 开头，便于识别；
   - `Fuc` 是 "Function"（函数）的缩写。

2. **函数命名原则**：
   - 函数名应清晰表达函数的用途和功能；
   - 推荐使用动词+名词的组合形式。

3. **描述性名称**：
   - 使用"动词 + 名词"或"动词短语"形式；
   - 推荐动词：`求`、`计算`、`获取`、`设置`、`添加`、`删除`、`更新`、`检查`、`验证` 等；
   - 示例：
     - `Fuc_求平方根`
     - `Fuc_获取成绩`
     - `Fuc_读取内容`
     - `Fuc_发送数据`

4. **参数命名**：
   - 函数参数同样遵循变量命名规范；
   - 参数名应清晰表达参数的用途。

### 4.3 常量命名规范

**格式**：`常量_[描述性名称]`（全大写，使用下划线分隔）

```cn
常量 常量_圆周率 = 3.14159;
常量 常量_最大用户数 = 1000;
常量 常量_默认端口 = 8080;
```

### 4.4 枚举命名规范

1. **枚举类型名**：使用 `Enum_[类型名]` 格式

2. **枚举值命名**：使用 `枚举_[类型名]_[值名]` 格式（全大写）

```cn
枚举 Enum_颜色_类型
{
    枚举_颜色_类型_红色,
    枚举_颜色_类型_绿色,
    枚举_颜色_类型_蓝色
}

枚举 Enum_系统_状态
{
    枚举_系统_状态_未启动,
    枚举_系统_状态_运行中,
    枚举_系统_状态_已停止
}
```

### 4.5 结构体命名规范

**格式**：`Struct_[类型名]`

```cn
结构体 Struct_学生_信息
{
    变量 str_名字;
    变量 int_年龄;
    变量 arr_成绩[10];
}

结构体 Struct_坐标_点
{
    变量 float_X;
    变量 float_Y;
}
```

### 4.6 模块命名规范

1. **模块名**：使用简洁的中文名词或名词短语

```cn
模块 数学
{
公开:
    函数 Fuc_求和(变量 int_a, 变量 int_b) -> 整数
    {
        返回 int_a + int_b;
    }
}

模块 学生管理
{
私有:
    变量 int_总人数 = 0;
    
公开:
    函数 Fuc_增加人数() -> 空
    {
        int_总人数 = int_总人数 + 1;
    }
}
```

## 5. 函数设计规范

1. **单一职责**：
   - 每个函数只做一件相对清晰的事情；
   - 出现大量条件分支或嵌套时，应考虑拆分为多个小函数。

2. **参数数量**：
   - 建议函数参数不超过 5 个；
   - 若超过，考虑封装为结构体参数。

3. **返回值**：
   - 明确标注函数返回类型（`-> 类型` 或 `-> 空`）；
   - 避免复杂的返回值类型，优先使用基本类型或结构体。

4. **早返回优先**：
   - 尽量使用"早返回"减少嵌套层级：

   ```cn
   函数 Fuc_检查年龄(变量 int_年龄) -> 布尔
   {
       如果 (int_年龄 < 0) {
           返回 假;
       }
       如果 (int_年龄 > 150) {
           返回 假;
       }
       返回 真;
   }
   ```

## 6. 注释规范

1. **注释语言**：
   - 使用简明中文描述业务含义、语义约束；
   - 注释应与代码的中文语义化风格保持一致。

2. **注释风格**：
   - 行注释使用 `//`；
   - 块注释使用 `/* ... */`；
   - 不使用花哨装饰，保持简洁。

3. **注释内容**：
   - 注释应解释"做什么"和"为什么这样做"，而不是逐行翻译代码；
   - 复杂算法或非直观实现，必须在函数头部写明设计思路。

4. **函数注释示例**：

   ```cn
   // 功能：计算圆的面积
   // 参数：float_半径 - 圆的半径
   // 返回：圆的面积（小数类型）
   // 注意：半径必须为正数
   函数 Fuc_求圆的面积(变量 float_半径) -> 小数
   {
       返回 3.14159 * float_半径 * float_半径;
   }
   ```

5. **TODO/FIXME 标记**：
   - 使用统一格式：`// TODO: 描述`、`// FIXME: 描述`；
   - 必要时附上任务编号或负责人。

## 7. 模块系统使用规范

### 7.1 模块定义

```cn
模块 数学工具
{
私有:
    // 私有常量（模块内可见）
    常量 常量_默认精度 = 0.0001;
    
    // 私有函数（仅模块内可用）
    函数 Fuc_内部计算(变量 int_值) -> 整数
    {
        返回 int_值 * 2;
    }

公开:
    // 公开函数（对外可见）
    函数 Fuc_求绝对值(变量 float_数值) -> 小数
    {
        如果 (float_数值 < 0) {
            返回 -float_数值;
        }
        返回 float_数值;
    }
}
```

### 7.2 模块导入

```cn
// 导入整个模块
导入 数学工具;

// 使用导入的函数
函数 主函数() -> 整数
{
    变量 float_结果 = 数学工具.Fuc_求绝对值(-5.5);
    返回 0;
}
```

### 7.3 模块可见性原则

1. **块作用域标记**：使用 `公开:` 和 `私有:` 标记可见性块，块内的所有成员继承该可见性；
2. **默认私有**：未标记的成员默认为私有（仅模块内可见）；
3. **最小暴露**：只暴露必要的接口，隐藏实现细节；
4. **分组组织**：建议将相同可见性的成员分组放在同一块内，提高代码可读性。

## 8. 控制流语句规范

### 8.1 条件语句

```cn
// 推荐写法
如果 (int_年龄 >= 18) {
    // 成年人处理逻辑
} 否则如果 (int_年龄 >= 12) {
    // 青少年处理逻辑
} 否则 {
    // 儿童处理逻辑
}

// 必须使用大括号，即使只有一行
如果 (bool_已启动) {
    Fuc_执行任务();
}
```

### 8.2 循环语句

```cn
// for 循环
循环 (变量 int_i = 0; int_i < 10; int_i = int_i + 1) {
    // 循环体
}

// while 循环
当 (bool_继续) {
    // 循环体
}
```

### 8.3 多路分支

```cn
分支 (enum_当前状态)
{
    情况 枚举_系统_状态_未启动:
        Fuc_启动();
        中断;
    
    情况 枚举_系统_状态_运行中:
        Fuc_处理();
        中断;
    
    默认:
        Fuc_错误处理();
        中断;
}
```

## 9. 代码组织最佳实践

### 9.1 文件结构顺序

```cn
// 1. 文件头注释
// 文件名：学生管理.cn
// 功能：学生信息管理相关功能
// 作者：XXX
// 日期：2026-01-26

// 2. 导入语句
导入 数学工具;
导入 字符串工具;

// 3. 常量定义
常量 常量_最大人数 = 500;

// 4. 结构体定义
结构体 Struct_信息
{
    变量 str_名字;
    变量 int_年龄;
}

// 5. 模块定义或函数定义
模块 学生管理
{
    // 模块内容
}

// 6. 主函数（如果有）
函数 主函数() -> 整数
{
    返回 0;
}
```

### 9.2 代码分组

- 相关功能的函数应分组放置，组间用注释分隔：

```cn
模块 学生管理
{
私有:
    变量 int_学生数量 = 0;

公开:
    // ========== 学生信息管理 ==========
    
    函数 Fuc_添加(变量 str_名字) -> 布尔
    {
        // 实现
    }
    
    函数 Fuc_删除(变量 int_ID) -> 布尔
    {
        // 实现
    }
    
    // ========== 成绩管理 ==========
    
    函数 Fuc_录入成绩(变量 int_ID, 变量 float_成绩) -> 布尔
    {
        // 实现
    }
}
```

## 10. 测试代码风格

1. **测试文件命名**：
   - 使用 `测试_[功能模块].cn` 格式；
   - 例如：`测试_数学工具.cn`、`测试_学生管理.cn`。

2. **测试函数命名**：
   - 使用 `Fuc_测试_[测试场景]` 格式；
   - 例如：`Fuc_测试_求圆面积正常情况`、`Fuc_测试_添加学生边界条件`。

3. **测试代码可读性**：
   - 测试代码应特别注重可读性，清晰表达测试意图；
   - 每个测试函数只测试一个特定场景。

```cn
// 测试示例
函数 Fuc_求圆面积正常情况() -> 布尔
{
    变量 float_半径 = 5.0;
    变量 float_期望结果 = 78.53975;
    变量 float_实际结果 = Fuc_求圆的面积(float_半径);
    
    如果 (float_实际结果 == float_期望结果) {
        返回 真;
    }
    返回 假;
}
```

## 11. 常见场景命名示例

### 11.1 数学计算

```cn
函数 Fuc_求两点距离(
    变量 float_X1,
    变量 float_Y1,
    变量 float_X2,
    变量 float_Y2
) -> 小数
{
    变量 float_差X = float_X2 - float_X1;
    变量 float_差Y = float_Y2 - float_Y1;
    返回 Fuc_求平方根(float_差X * float_差X + float_差Y * float_差Y);
}
```

### 11.2 数据处理

```cn
函数 Fuc_求平均值(变量 arr_数组[], 变量 int_长度) -> 小数
{
    变量 float_总和 = 0.0;
    循环 (变量 int_i = 0; int_i < int_长度; int_i = int_i + 1) {
        float_总和 = float_总和 + arr_数组[int_i];
    }
    返回 float_总和 / int_长度;
}
```

### 11.3 业务逻辑

```cn
函数 Fuc_是否及格(变量 float_成绩) -> 布尔
{
    常量 常量_及格线 = 60.0;
    
    如果 (float_成绩 >= 常量_及格线) {
        返回 真;
    }
    返回 假;
}
```

## 12. 禁止事项

1. **禁止使用拼音缩写**：
   - ❌ 错误：`变量 xs_xm = "张三";`
   - ✅ 正确：`变量 str_姓名 = "张三";`

2. **禁止使用无意义的变量名**：
   - ❌ 错误：`变量 a`, `变量 temp`, `变量 data`
   - ✅ 正确：`变量 int_计数器`, `变量 str_缓存`, `变量 struct_数据`

3. **禁止混用中英文**：
   - ❌ 错误：`函数 calculate_面积(变量 r)`
   - ✅ 正确：`函数 Fuc_计算面积(变量 float_半径)`

4. **禁止省略大括号**：
   - ❌ 错误：`如果 (条件) 执行语句();`
   - ✅ 正确：`如果 (条件) { 执行语句(); }`

5. **禁止不一致的命名风格**：
   - 同一项目中必须统一使用本规范定义的命名格式。

## 13. 版本与维护

本规范为首版，适用于 CN_Language 1.0 版本。

- **修订原则**：可在开发过程中根据实际经验迭代更新；
- **修订流程**：修改需在评审后统一调整所有示例代码，避免风格混乱；
- **反馈渠道**：开发者可通过 issue 或内部讨论提出改进建议。

---

**附录：快速参考表**

| 元素类型 | 命名格式 | 示例 |
|---------|---------|------|
| 整数变量 | `int_[名称]` | `int_长度` |
| 小数变量 | `float_[名称]` | `float_速度` |
| 字符串变量 | `str_[名称]` | `str_姓名` |
| 布尔变量 | `bool_[名称]` | `bool_已启动` |
| 数组变量 | `arr_[名称]` | `arr_成绩` |
| 函数 | `Fuc_[动作名称]` | `Fuc_求和` |
| 常量 | `常量_[名称]` | `常量_最大值` |
| 结构体 | `Struct_[类型]` | `Struct_信息` |
| 枚举类型 | `Enum_[类型]` | `Enum_类型` |
| 枚举值 | `枚举_[类型]_[值]` | `枚举_类型_红色` |
| 模块 | `[简洁中文名]` | `数学`、`学生管理` |
