# CN_Language 语言规范草案（核心子集）

> 本文为 CN_Language 的 **语言规范草案（首版）**，重点定义一个可在阶段 1/2 实现的核心语言子集。
> 后续版本可以在不破坏兼容性的前提下扩展。

## 1. 总体设计目标

1. 使用 **中文关键字和标识符**，语义贴近 C 语言和常见系统语言，但保持简洁。
2. 适合编写 **系统级程序**：操作系统、运行时、工具等，支持 freestanding 场景。
3. 初期通过编译为 C 代码来复用现有 C 编译器生态。

## 2. 基本词法要素

### 2.1 源文件与编码

1. 源文件扩展名为：`.cn`。
2. 源文件推荐使用 UTF-8 编码（无 BOM），以支持中文标识符和字符串。

### 2.2 标识符

1. 标识符可由以下字符组成：
   - Unicode 字母（含中文）
   - 数字 0-9（首字符不能为数字）
   - 下划线 `_`
2. 标识符区分大小写。
3. 与关键字同拼写的序列不能作为标识符使用。

### 2.3 关键字（核心子集）

当前规范草案中，定义以下关键字（后续可扩展）：

- 函数：声明函数。
- 返回：从函数返回值。
- 变量：类型推断的局部变量声明。
- 整数：整型类型。
- 小数：浮点型类型（暂可视为双精度）。
- 布尔：布尔类型。
- 字符串：字符串类型。
- 数组：数组类型修饰符。
- 结构体：定义结构体类型。
- 模块：定义模块。
- 导入：导入模块。
- 如果 / 否则：条件分支。
- 当：循环结构（类似 `while`）。
- 循环：循环结构（类似 `for`）。
- 主程序：程序入口函数名。

（注：其他内建函数如 `打印`、`类型名` 等视为标准库/内建函数，而非关键字。）

### 2.4 字面量

1. 整数字面量：
   - 十进制：`0`、`123`、`4567`；
   - 未来可扩展十六进制、二进制（本草案不强制定义）。

2. 小数字面量：
   - 使用十进制小数点：`1.0`、`3.14`；

3. 字符串字面量：
   - 使用双引号包围：`"你好"`；
   - 字符串内部可以包含中文和转义字符（如 `"\n"`）。

4. 布尔字面量：
   - 草案建议使用：`真`、`假`（后续可在实现时调整）。

### 2.5 注释

1. 行注释使用：`// 注释内容`。
2. 块注释使用：`/* 注释内容 */`。

## 3. 类型系统（核心子集）

### 3.1 基本类型

1. 整数：表示有符号整数（具体位宽由实现决定，建议对应 C 的 `int`）。
2. 小数：表示浮点数（建议对应 C 的 `double`）。
3. 布尔：表示逻辑真/假。
4. 字符串：表示不可变或逻辑上不可变的字符串（具体实现可通过指针 + 长度）。

### 3.2 复合类型

1. 数组：
   - 使用 `数组 T` 表示元素类型为 `T` 的数组，或使用字面量 `[a, b, c]` 创建数组；
   - 支持下标访问：`数组变量[i]`；
   - 示例：`数组 数字数组 = [1, 2, 3];`。

2. 指针：
   - 使用 `T*` 表示指向 `T` 的指针：`整数* 指针`；
   - 支持解引用：`*指针`。

3. 引用：
   - 使用 `T&` 表示对 `T` 的引用：`整数& 引用`；
   - 引用作为参数时表示可修改实参的别名。

4. 结构体：
   - 使用 `结构体 名字 { 字段列表 }` 定义：

     ```
     结构体 人员 {
         字符串 姓名;
         整数 年龄;
         小数 身高;
     }
     ```

   - 可通过字面量构造：`人员{姓名, 年龄, 身高}`。

### 3.3 变量声明与类型推断

1. 显式类型声明：

   ```
   整数 年龄 = 30;
   字符串 姓名 = "张三";
   数组 数字列表 = [1, 2, 3];
   ```

2. 使用 `变量` 进行类型推断：

   ```
   变量 和 = 0;          // 根据初始值推断为整数
   变量 文本 = "你好";   // 推断为字符串
   ```

## 4. 表达式与语句

### 4.1 表达式

1. 支持基本算术运算：`+`、`-`、`*`、`/`、`%`；
2. 支持比较运算：`==`、`!=`、`<`、`<=`、`>`、`>=`；
3. 支持逻辑运算：`&&`、`||`、`!`；
4. 支持字符串拼接：使用 `+` 连接字符串和其他可转换为字符串的值（具体转换规则由运行时决定）。

### 4.2 赋值语句

1. 使用 `=` 进行赋值：

   ```
   变量 i = 0;
   i = i + 1;
   ```

### 4.3 条件语句

1. `如果/否则` 语句：

   ```
   如果 (条件) {
       // 分支1
   } 否则 {
       // 分支2
   }
   ```

2. 可以只有 `如果` 部分，也可以带 `否则` 部分；
3. 条件必须为布尔类型。

### 4.4 循环语句

1. 使用 `当` 实现类似 `while` 的循环：

   ```
   当 (i < 长度) {
       // 循环体
       i = i + 1;
   }
   ```

2. 条件必须为布尔类型。

## 5. 函数与程序结构

### 5.1 函数声明与定义

1. 基本形式：

   ```
   函数 返回类型 函数名(参数列表) {
       // 函数体
   }
   ```

2. 示例：

   ```
   函数 整数 加(整数 a, 整数 b) {
       返回 a + b;
   }

   函数 变量 乘(变量 a, 变量 b) {
       返回 a * b;
   }
   ```

3. 函数可以无返回值，此时返回类型可省略或使用特定关键字（草案阶段可允许“省略返回类型表示无返回”方案，后续可细化）。

### 5.2 参数与返回

1. 参数列表使用逗号分隔：`(类型1 名1, 类型2 名2)`；
2. 支持值传递、指针参数、引用参数；
3. 使用 `返回` 语句返回值：`返回 表达式;`。

### 5.3 主程序入口

1. 入口函数约定名为：`主程序`：

   ```
   函数 主程序() {
       // 程序入口逻辑
       返回 0;
   }
   ```

2. 编译器在生成 C 代码时，将 `主程序` 映射为 C 的 `main` 函数。

## 6. 模块系统

### 6.1 模块定义

1. 使用 `模块 名字 { ... }` 定义模块：

   ```
   模块 数学工具 {
       函数 整数 加(整数 a, 整数 b) {
           返回 a + b;
       }

       整数 圆周率近似值 = 3;
   }
   ```

2. 模块内部可以定义函数、常量等。

### 6.2 模块导入与使用

1. 使用 `导入 模块名;` 导入模块：

   ```
   导入 数学工具;
   ```

2. 使用 `模块名.成员` 访问模块成员：

   ```
   变量 结果 = 数学工具.加(1, 2);
   ```

3. 模块是命名空间和封装单元，未来可扩展访问控制（公开/私有）。

## 7. 运行时约束（核心子集）

1. 语言依赖一个最小运行时提供：
   - 字符串管理与拼接；
   - 基本 I/O（如 `打印` 函数）；
   - 数组的基本操作与长度获取（如 `长度()`）。

2. 在 freestanding 模式下：
   - 不依赖系统标准库文件 I/O；
   - `打印` 等接口需要由运行时适配到具体平台输出（串口、屏幕缓冲区等）。

3. 错误处理：
   - 如除数为零等运行时错误，规范建议使用 **打印错误信息 + 返回约定值** 的方式；
   - 后续可扩展异常/错误类型系统。

## 8. 未来扩展（非本阶段必需）

1. 泛型与高阶函数语法糖；
2. 更丰富的集合类型（映射、集合等）；
3. 并发原语；
4. 模块/包管理（跨文件、跨工程模块系统）。

---

本语言规范草案主要面向 **阶段 1（前端基础）和阶段 2（语义分析）** 的实现需要。
后续如有语法或语义变更，应同步更新本文档，并在测试规范中增加相应测试要求。
