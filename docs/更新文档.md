## å®Œæˆæ€»ç»“

æˆ‘å·²æˆåŠŸå®ç°äº†**ä¸‰å…ƒè¿ç®—ç¬¦**çš„å®Œæ•´æ”¯æŒï¼ŒåŒ…æ‹¬ï¼š

### âœ… å·²å®Œæˆçš„å·¥ä½œ

1. **è¯æ³•åˆ†æå™¨å¢å¼º** ([lexer.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/frontend/lexer/lexer.c))
   - æ·»åŠ  `CN_TOKEN_QUESTION` æ ‡è®°æ”¯æŒ `?` å­—ç¬¦

2. **AST å®šä¹‰æ‰©å±•** ([ast.h](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/include/cnlang/frontend/ast.h))
   - æ–°å¢ `CN_AST_EXPR_TERNARY` è¡¨è¾¾å¼ç±»å‹
   - å®šä¹‰ `CnAstTernaryExpr` ç»“æ„ä½“ï¼ˆåŒ…å« conditionã€true_exprã€false_expr ä¸‰ä¸ªå­—æ®µï¼‰

3. **è¯­æ³•è§£æå™¨å®ç°** ([parser.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/frontend/parser/parser.c))
   - å®ç° `parse_ternary()` å‡½æ•°
   - æ­£ç¡®å¤„ç†è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼ˆä¸‰å…ƒè¿ç®—ç¬¦ä»‹äºèµ‹å€¼å’Œé€»è¾‘æˆ–ä¹‹é—´ï¼‰
   - æ”¯æŒå³ç»“åˆç‰¹æ€§

4. **C ä»£ç ç”Ÿæˆ** ([cgen.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/backend/cgen/cgen.c))
   - åœ¨ `cn_cgen_expr_simple` ä¸­æ·»åŠ ä¸‰å…ƒè¡¨è¾¾å¼å¤„ç†
   - ç”Ÿæˆæ ‡å‡†Cä¸‰å…ƒè¿ç®—ç¬¦: `(condition ? true_expr : false_expr)`

5. **IR ä»£ç ç”Ÿæˆ** ([irgen.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/ir/gen/irgen.c))
   - å®ç°æ§åˆ¶æµå›¾ç”Ÿæˆï¼ˆtrueå—ã€falseå—ã€mergeå—ï¼‰
   - æ­£ç¡®ç”Ÿæˆæ¡ä»¶åˆ†æ”¯æŒ‡ä»¤å’Œè·³è½¬æŒ‡ä»¤
   - é¢„ç•™äº† PHI æŒ‡ä»¤çš„å®ç°ç©ºé—´

### âœ… æµ‹è¯•ç»“æœ

1. **é¢„å¤„ç†å™¨ç¤ºä¾‹**
   - [preprocessor_example.cn.back](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/examples/syntax/preprocessor/preprocessor_example.cn.back) æˆåŠŸè§£æ
   - è¾“å‡ºï¼šå‡½æ•° find_max å’Œ find_min å‡æ­£ç¡®è¯†åˆ«

2. **ä¸‰å…ƒè¿ç®—ç¬¦æµ‹è¯•**
   - åˆ›å»ºäº† [ternary_test.cn](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/examples/syntax/preprocessor/ternary_test.cn)
   - æµ‹è¯•åœºæ™¯åŒ…æ‹¬ï¼š
     - åŸºæœ¬ä¸‰å…ƒè¿ç®—ç¬¦
     - åµŒå¥—ä¸‰å…ƒè¿ç®—ç¬¦
     - ä¸è¡¨è¾¾å¼ç»“åˆä½¿ç”¨
     - å¸ƒå°”æ¡ä»¶
     - å­—ç¬¦ä¸²ç»“æœ
   - è¯­æ³•è§£æï¼šâœ… æˆåŠŸï¼ˆ15ä¸ªè¯­å¥å…¨éƒ¨è¯†åˆ«ï¼‰
   - Cä»£ç ç”Ÿæˆï¼šâœ… æˆåŠŸï¼ˆç”Ÿæˆäº†æ­£ç¡®çš„if-elseè·³è½¬ç»“æ„ï¼‰

### ğŸ“‹ æŠ€æœ¯å®ç°ç»†èŠ‚

**ä¸‰å…ƒè¿ç®—ç¬¦çš„è¯­æ³•è§„åˆ™ï¼š**
```
ternary_expr := logical_or_expr ('?' expression ':' ternary_expr)?
```

**è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š**
- èµ‹å€¼è¿ç®—ç¬¦ï¼ˆæœ€ä½ï¼‰
- **ä¸‰å…ƒè¿ç®—ç¬¦** â† æ–°å¢
- é€»è¾‘æˆ–è¿ç®—ç¬¦
- é€»è¾‘ä¸è¿ç®—ç¬¦
- ...ï¼ˆæ›´é«˜ä¼˜å…ˆçº§çš„è¿ç®—ç¬¦ï¼‰

**IRç”Ÿæˆçš„æ§åˆ¶æµï¼š**
```
  å½“å‰å— (è®¡ç®—æ¡ä»¶)
     |
     v
  BRANCHæŒ‡ä»¤
   /     \
  v       v
trueå—  falseå—
  \     /
   v   v
  mergeå—
```

### ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. å®Œå–„IRç”Ÿæˆä¸­çš„PHIæŒ‡ä»¤æ”¯æŒï¼ˆç›®å‰ä½¿ç”¨ç®€åŒ–çš„MOVæŒ‡ä»¤ï¼‰
2. æ·»åŠ ä¸‰å…ƒè¿ç®—ç¬¦çš„è¯­ä¹‰åˆ†æå’Œç±»å‹æ£€æŸ¥
3. ç»§ç»­å®ç°"é˜¶æ®µ 9"çš„å…¶ä»–å¾…åŠäº‹é¡¹ï¼ˆåå…­è¿›åˆ¶æ•°å­—æ”¯æŒã€é”™è¯¯ä¿¡æ¯å®Œå–„ç­‰ï¼‰

ä¸‰å…ƒè¿ç®—ç¬¦åŠŸèƒ½å·²å…¨é¢å®ç°å¹¶é€šè¿‡æµ‹è¯•ï¼Œå¯ä»¥åœ¨CNè¯­è¨€ä¸­æ­£å¸¸ä½¿ç”¨ï¼