/*
 * CN_Language 标准库中文接口示例程序
 * 演示如何使用标准库的中文接口函数
 */

// 引入标准库中文接口
#include "cnlang/runtime/stdlib.h"
#include <stdio.h>

// 演示内存管理
void 演示内存管理(void)
{
    printf("\n=== 内存管理函数演示 ===\n");
    
    // 分配内存
    int* 数组 = (int*)分配内存(5 * sizeof(int));
    if (数组 != NULL) {
        printf("成功分配5个整数的内存空间\n");
        
        // 填充数据
        for (int i = 0; i < 5; i++) {
            数组[i] = i * 10;
        }
        
        // 显示数据
        printf("数组内容: ");
        for (int i = 0; i < 5; i++) {
            printf("%d ", 数组[i]);
        }
        printf("\n");
        
        // 重新分配更大空间
        数组 = (int*)重新分配内存(数组, 10 * sizeof(int));
        if (数组 != NULL) {
            printf("成功重新分配为10个整数的空间\n");
            
            // 填充新空间
            for (int i = 5; i < 10; i++) {
                数组[i] = i * 10;
            }
            
            printf("扩展后数组: ");
            for (int i = 0; i < 10; i++) {
                printf("%d ", 数组[i]);
            }
            printf("\n");
        }
        
        // 释放内存
        释放内存(数组);
        printf("已释放内存\n");
    }
    
    // 分配清零内存
    int* 清零数组 = (int*)分配清零内存(3, sizeof(int));
    if (清零数组 != NULL) {
        printf("\n分配清零内存测试: ");
        for (int i = 0; i < 3; i++) {
            printf("%d ", 清零数组[i]);
        }
        printf("(应该全是0)\n");
        释放内存(清零数组);
    }
}

// 演示字符串处理
void 演示字符串处理(void)
{
    printf("\n=== 字符串处理函数演示 ===\n");
    
    // 字符串复制
    char 缓冲区1[50];
    复制字符串(缓冲区1, "你好，CN_Language！");
    printf("复制字符串: %s\n", 缓冲区1);
    
    // 字符串连接
    char 缓冲区2[100] = "欢迎使用";
    连接字符串(缓冲区2, " CN_Language 编程语言");
    printf("连接字符串: %s\n", 缓冲区2);
    
    // 字符串比较
    const char* 字符串A = "apple";
    const char* 字符串B = "banana";
    int 比较结果 = 比较字符串(字符串A, 字符串B);
    printf("比较 \"%s\" 和 \"%s\": %d ", 字符串A, 字符串B, 比较结果);
    if (比较结果 < 0) {
        printf("(第一个较小)\n");
    } else if (比较结果 > 0) {
        printf("(第一个较大)\n");
    } else {
        printf("(相等)\n");
    }
    
    // 获取字符串长度
    const char* 测试字符串 = "Hello World";
    size_t 长度 = 获取字符串长度(测试字符串);
    printf("字符串 \"%s\" 的长度: %zu\n", 测试字符串, 长度);
    
    // 查找字符
    char* 位置 = 查找字符(测试字符串, 'o');
    if (位置 != NULL) {
        printf("在位置 %ld 找到字符 'o'\n", 位置 - 测试字符串);
    }
    
    // 查找子串
    char* 子串位置 = 查找子串(测试字符串, "World");
    if (子串位置 != NULL) {
        printf("在位置 %ld 找到子串 \"World\"\n", 子串位置 - 测试字符串);
    }
}

// 演示内存操作
void 演示内存操作(void)
{
    printf("\n=== 内存操作函数演示 ===\n");
    
    // 复制内存
    int 源数组[] = {10, 20, 30, 40, 50};
    int 目标数组[5];
    
    复制内存(目标数组, 源数组, sizeof(源数组));
    printf("复制内存后: ");
    for (int i = 0; i < 5; i++) {
        printf("%d ", 目标数组[i]);
    }
    printf("\n");
    
    // 设置内存
    char 字符数组[10];
    设置内存(字符数组, 'X', sizeof(字符数组) - 1);
    字符数组[9] = '\0';
    printf("设置内存后: %s\n", 字符数组);
    
    // 比较内存
    int 数组A[] = {1, 2, 3};
    int 数组B[] = {1, 2, 3};
    int 数组C[] = {1, 2, 4};
    
    printf("比较内存 A 和 B: %d (应该相等)\n", 比较内存(数组A, 数组B, sizeof(数组A)));
    printf("比较内存 A 和 C: %d (应该不等)\n", 比较内存(数组A, 数组C, sizeof(数组A)));
}

// 演示格式化输出
void 演示格式化输出(void)
{
    printf("\n=== 格式化输出函数演示 ===\n");
    
    // 格式化打印到标准输出
    格式化打印("整数: %d, 小数: %.2f, 字符串: %s\n", 42, 3.14, "测试");
    
    // 格式化到字符串
    char 缓冲区[100];
    格式化字符串(缓冲区, "年份: %d, 月份: %d", 2026, 1);
    printf("格式化字符串结果: %s\n", 缓冲区);
    
    // 安全格式化（带长度限制）
    char 小缓冲区[20];
    安全格式化字符串(小缓冲区, sizeof(小缓冲区), "这是一个很长的测试字符串");
    printf("安全格式化（截断）: %s\n", 小缓冲区);
}

// 演示辅助函数
void 演示辅助函数(void)
{
    printf("\n=== 辅助函数演示 ===\n");
    
    // 获取绝对值
    printf("绝对值(10) = %lld\n", 获取绝对值(10));
    printf("绝对值(-25) = %lld\n", 获取绝对值(-25));
    
    // 求最大值
    printf("最大值(15, 28) = %lld\n", 求最大值(15, 28));
    
    // 求最小值
    printf("最小值(15, 28) = %lld\n", 求最小值(15, 28));
}

// 实际应用示例：处理学生数据
typedef struct {
    char 姓名[50];
    int 年龄;
    float 成绩;
} 学生;

void 演示实际应用(void)
{
    printf("\n=== 实际应用示例：学生管理 ===\n");
    
    // 分配学生数组
    int 学生数量 = 3;
    学生* 学生列表 = (学生*)分配清零内存(学生数量, sizeof(学生));
    
    if (学生列表 != NULL) {
        // 填充学生数据
        复制字符串(学生列表[0].姓名, "张三");
        学生列表[0].年龄 = 20;
        学生列表[0].成绩 = 85.5f;
        
        复制字符串(学生列表[1].姓名, "李四");
        学生列表[1].年龄 = 21;
        学生列表[1].成绩 = 92.0f;
        
        复制字符串(学生列表[2].姓名, "王五");
        学生列表[2].年龄 = 19;
        学生列表[2].成绩 = 78.5f;
        
        // 显示学生信息
        printf("\n学生名单:\n");
        printf("--------------------------------------\n");
        for (int i = 0; i < 学生数量; i++) {
            格式化打印("%-10s  年龄:%2d  成绩:%.1f\n", 
                       学生列表[i].姓名, 
                       学生列表[i].年龄, 
                       学生列表[i].成绩);
        }
        printf("--------------------------------------\n");
        
        // 查找最高分学生
        int 最高分索引 = 0;
        for (int i = 1; i < 学生数量; i++) {
            if (学生列表[i].成绩 > 学生列表[最高分索引].成绩) {
                最高分索引 = i;
            }
        }
        
        printf("\n最高分学生: %s (%.1f分)\n", 
               学生列表[最高分索引].姓名, 
               学生列表[最高分索引].成绩);
        
        // 释放内存
        释放内存(学生列表);
        printf("已释放学生数据内存\n");
    }
}

// 主函数
int main(void)
{
    printf("\n");
    printf("========================================\n");
    printf("CN_Language 标准库中文接口演示程序\n");
    printf("========================================\n");
    
    // 运行各个演示
    演示内存管理();
    演示字符串处理();
    演示内存操作();
    演示格式化输出();
    演示辅助函数();
    演示实际应用();
    
    printf("\n========================================\n");
    printf("演示完成！\n");
    printf("========================================\n\n");
    
    return 0;
}
