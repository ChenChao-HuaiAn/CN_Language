好的，我来实现 **TODO 2.2：在 Lexer 中接入 Diagnostics**。

让我先规划任务，然后查看当前 Lexer 的实现：
太好了！我发现 Lexer 已经：
1. ✅ 有 `diagnostics` 字段和 `filename` 字段
2. ✅ 有 `report_lex_error` 辅助函数
3. ✅ 有 `cn_frontend_lexer_set_diagnostics` 接口

现在让我查看完整的 `cn_frontend_lexer_next_token` 函数，找到需要接入诊断的位置：
完美！我发现 **Lexer 已经完全接入了诊断功能**！让我更新任务状态并验证：
现在我需要检查和更新 Lexer 的使用处。让我先查看有哪些地方使用了 Lexer：
太好了！我发现：

1. ✅ **main.c 已经完全接入了 Diagnostics**（第156行设置、第165行给parser设置）
2. ⚠️ **lexer_function_examples_test.c 没有使用 Diagnostics**（但这只是个简单的输出测试，不需要强制要求）

现在让我检查所有 parser 测试是否使用了 Diagnostics：
好的！让我看看 parser_diagnostics_test 和 parser_hello_world_test 是怎么使用的：
完美！测试已经正确使用了 Diagnostics。现在让我编译验证一下，确保 Lexer 的诊断功能工作正常：
太好了！现在让我创建一个测试文件，验证 Lexer 的诊断功能是否真正工作：
命令执行了，但没有输出。让我检查一下是否有错误输出：
完美！✅ **Lexer 的诊断功能正常工作！** 我们可以看到：

1. ✅ **未终止的字符串字面量**被正确检测（错误码 1）
2. ✅ **位置信息准确**（文件名、行号、列号）
3. ✅ **中文错误消息**正确显示

现在让我测试非法字符的检测。让我创建一个更简单的测试文件：
文件创建可能有延迟，让我用绝对路径试试：
完美！✅ **非法字符检测也正常工作！** 我们可以看到：

1. ✅ **错误码 2** (`CN_DIAG_CODE_LEX_INVALID_CHAR`)
2. ✅ **准确的位置**（第3行第20列，正好是 `@` 的位置）
3. ✅ **中文错误消息**："非法字符"

现在删除测试文件，更新任务状态并总结：
完美！✅ **TODO 2.2 已完成**！

## ✅ 总结：TODO 2.2 - Lexer 接入 Diagnostics

### 📋 已完成内容

#### 1. **Lexer 结构更新** ([lexer.h](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/include/cnlang/frontend/lexer.h#L15-L23))
   - ✅ `CnLexer` 已包含 `diagnostics` 指针
   - ✅ `CnLexer` 已包含 `filename` 字段用于错误定位
   - ✅ 提供 `cn_frontend_lexer_set_diagnostics()` 接口

#### 2. **错误报告实现** ([lexer.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/frontend/lexer/lexer.c))
   - ✅ 第 55-68 行：`report_lex_error()` 辅助函数
   - ✅ 第 349 行：**未终止字符串**错误报告（错误码 `CN_DIAG_CODE_LEX_UNTERMINATED_STRING`）
   - ✅ 第 485 行：**非法字符**错误报告（错误码 `CN_DIAG_CODE_LEX_INVALID_CHAR`）

#### 3. **使用处集成**
   - ✅ [main.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/cli/cnc/main.c#L156)：正确初始化并设置 Diagnostics
   - ✅ [parser_diagnostics_test.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/unit/parser_diagnostics_test.c#L24)：测试中正确使用
   - ✅ [parser_hello_world_test.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/unit/parser_hello_world_test.c#L24)：测试中正确使用

#### 4. **功能验证**
   - ✅ 编译通过
   - ✅ 未终止字符串检测正常（输出：`错误(1): 文件:行:列: 未终止的字符串字面量`）
   - ✅ 非法字符检测正常（输出：`错误(2): 文件:行:列: 非法字符`）
   - ✅ 位置信息准确（文件名、行号、列号）
   - ✅ 中文错误消息正确显示

### 🎯 关键特性

- **零侵入**：Lexer 在没有 Diagnostics 时依然能正常工作（第 57 行判空保护）
- **位置精确**：使用 `start_line` 和 `start_column` 记录 token 起始位置
- **中文友好**：所有错误消息使用中文
- **符合规范**：遵循项目代码风格和命名规范

### 📌 下一步

TODO 2.2 已完成，接下来是：
- **TODO 2.3**：在 Parser 中接入 Diagnostics（语法错误）

需要我继续实现吗？