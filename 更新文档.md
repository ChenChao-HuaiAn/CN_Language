
我已完成 **阶段 3 TODO 列表** 中关于 **IR 优化 (Optional/Initial)** 的相关任务。

### 已完成的工作：

1.  **基础设施扩展**：
    *   在 `include/cnlang/ir/ir.h` 中新增了 `CN_IR_INST_MOV` 指令类型，用于支持寄存器间数据移动和立即数加载，这是常量折叠优化的基础。
    *   创建了 `src/ir/passes/` 目录，用于存放所有的优化 Pass。
2.  **定义 Pass 接口**：
    *   新建 `include/cnlang/ir/pass.h`，定义了统一的 Pass 函数原型 `CnIrPassFunc`，以及常量折叠、死代码删除和默认优化流水线接口。
3.  **实现常量折叠 (Constant Folding)**：
    *   在 `src/ir/passes/constant_folding.c` 中实现了对基本块内算术与逻辑指令的扫描。
    *   当操作数均为立即数时，提前在编译期计算结果，并将原指令替换为 `MOV` 指令（加载计算后的立即数）。
4.  **实现死代码删除 (Dead Code Elimination)**：
    *   在 `src/ir/passes/dead_code_elimination.c` 中实现了基于可达性分析的基础 Pass。
    *   通过从函数入口块开始进行深度优先搜索（DFS）标记可达块，自动移除所有无法执行到的孤立基本块，有效缩减最终生成的代码体积。
5.  **默认优化流水线**：
    *   提供了 `cn_ir_run_default_passes` 接口，方便后续在编译流程中一键开启这些优化。

### 更新后的 TODO 状态：

```markdown
#### 3. IR 优化 (Optional/Initial)
- [x] **常量折叠 (Constant Folding)**：实现基础的编译时常量计算优化。
- [x] **死代码删除 (Dead Code Elimination)**：初步实现移除不可达代码或无用赋值的 Pass。
```

**下一步建议**：
IR 层的设计与优化已初步完成，现在可以进入 **阶段 3 的最后一个大项：C 代码后端实现**。这包括：
1. 约定 C 接口 ABI 和类型映射。
2. 实现将 IR 指令转换为等效 C 代码的生成器。

需要我为您开始规划 C 后端的具体实现方案吗？