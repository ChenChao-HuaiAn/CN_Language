## å®æ–½æ€»ç»“

### 1. **æ ¸å¿ƒåŠŸèƒ½å®ç°**

å·²å®Œæˆä¸‰ä¸ªå…³é”®ä»»åŠ¡ï¼š

âœ… **åˆ—å‡ºç¦æ­¢å’Œå…è®¸çš„å‡½æ•°**ï¼ˆ148 è¡Œå¤´æ–‡ä»¶ï¼‰
- åˆ›å»ºäº† [`include/cnlang/semantics/freestanding_check.h`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/include/cnlang/semantics/freestanding_check.h)
- å®šä¹‰äº† `CnFsForbiddenFunc` æšä¸¾ï¼ˆç¦æ­¢å‡½æ•°ï¼‰ï¼š
  - æ–‡ä»¶ I/Oï¼šæ–‡ä»¶æ‰“å¼€ã€å…³é—­ã€è¯»å†™
  - æ§åˆ¶å°è¾“å…¥ï¼šè¯»å–è¡Œã€è¯»å–æ•´æ•°
  - å­—ç¬¦ä¸²é«˜çº§æ“ä½œï¼šæˆªå–ã€å»ç©ºæ ¼ã€æ ¼å¼åŒ–
  - è¿›ç¨‹ç®¡ç†ã€ç½‘ç»œæ“ä½œï¼ˆé¢„ç•™ï¼‰
- å®šä¹‰äº† `CnFsAllowedFunc` æšä¸¾ï¼ˆå…è®¸å‡½æ•°ï¼‰ï¼š
  - åŸºç¡€æ‰“å°å‡½æ•°
  - åŸºç¡€å­—ç¬¦ä¸²æ“ä½œ
  - å†…å­˜ç®¡ç†
  - æ•°å­¦å‡½æ•°

âœ… **è¯­ä¹‰åˆ†æé˜¶æ®µé›†æˆæ£€æŸ¥**ï¼ˆ381 è¡Œå®ç°æ–‡ä»¶ï¼‰
- åˆ›å»ºäº† [`src/semantics/checker/freestanding_check.c`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/src/semantics/checker/freestanding_check.c)
- å®ç°äº†å‡½æ•°ååŒ¹é…é€»è¾‘ï¼ˆä¸­æ–‡å‡½æ•°åæ£€æŸ¥ï¼‰
- é€’å½’éå† AST æ£€æŸ¥æ‰€æœ‰å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼
- åœ¨ [`src/semantics/checker/semantic_passes.c`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/src/semantics/checker/semantic_passes.c) ä¸­æ·»åŠ äº† `cn_sem_check_freestanding` æ¥å£

âœ… **ç»Ÿä¸€çš„è¯Šæ–­ä¿¡æ¯**
- ä¸ºæ¯ä¸ªç¦æ­¢å‡½æ•°æä¾›æ¸…æ™°çš„ä¸­æ–‡æè¿°
- é€šè¿‡ç°æœ‰çš„ `cn_support_diag_semantic_error_generic` å‡½æ•°è¾“å‡ºé”™è¯¯
- ç¤ºä¾‹é”™è¯¯ä¿¡æ¯ï¼š
  - "æ–‡ä»¶æ‰“å¼€æ“ä½œåœ¨ freestanding æ¨¡å¼ä¸‹ä¸å¯ç”¨ï¼ˆæ— æ–‡ä»¶ç³»ç»Ÿï¼‰"
  - "æ§åˆ¶å°è¾“å…¥åœ¨ freestanding æ¨¡å¼ä¸‹ä¸å¯ç”¨ï¼ˆä½¿ç”¨å†…æ ¸æä¾›çš„è¾“å…¥æœºåˆ¶ï¼‰"

### 2. **æ„å»ºç³»ç»Ÿæ›´æ–°**

- âœ… æ›´æ–°äº† [`src/CMakeLists.txt`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/src/CMakeLists.txt) æ·»åŠ æ–°æºæ–‡ä»¶
- âœ… æ›´æ–°äº† [`tests/unit/CMakeLists.txt`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/unit/CMakeLists.txt) ä¿®å¤é“¾æ¥é”™è¯¯
- âœ… æ›´æ–°äº† [`tests/integration/CMakeLists.txt`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/tests/integration/CMakeLists.txt) ä¿®å¤é“¾æ¥é”™è¯¯

### 3. **æµ‹è¯•éªŒè¯**

âœ… **æ‰€æœ‰ 32 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡**ï¼š
- å•å…ƒæµ‹è¯•ï¼š20 ä¸ªé€šè¿‡
- é›†æˆæµ‹è¯•ï¼š5 ä¸ªé€šè¿‡
- è¿è¡Œæ—¶æµ‹è¯•ï¼š7 ä¸ªé€šè¿‡

âœ… **åˆ›å»ºäº†ç¤ºä¾‹æ–‡ä»¶**ï¼š
- [`examples/test_freestanding_violation.cn`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/examples/test_freestanding_violation.cn)ï¼šåŒ…å«è¿è§„å‡½æ•°è°ƒç”¨
- [`examples/test_freestanding_allowed.cn`](file://c:/Users/ChenChao/Documents/gitcode/CN_Language/examples/test_freestanding_allowed.cn)ï¼šä»…åŒ…å«å…è®¸çš„å‡½æ•°è°ƒç”¨

### 4. **å…³é”®æŠ€æœ¯å®ç°**

**å‡½æ•°åŒ¹é…æœºåˆ¶**ï¼ˆæ”¯æŒä¸­æ–‡å‡½æ•°åï¼‰ï¼š
```c
static bool name_matches(const char* name, size_t name_len, const char* target) {
    size_t target_len = strlen(target);
    return name_len == target_len && memcmp(name, target, name_len) == 0;
}
```

**AST é€’å½’éå†**ï¼š
- æ£€æŸ¥å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼ä¸­çš„è¢«è°ƒç”¨å‡½æ•°å
- é€’å½’æ£€æŸ¥å‡½æ•°å‚æ•°
- éå†æ‰€æœ‰è¯­å¥ç±»å‹ï¼ˆå˜é‡å£°æ˜ã€è¿”å›ã€ifã€whileã€for ç­‰ï¼‰

**è¯Šæ–­ä¿¡æ¯è¾“å‡º**ï¼š
```c
const char* desc = cn_fs_get_forbidden_func_desc(forbidden);
cn_support_diag_semantic_error_generic(diagnostics, 0, NULL, 0, 0, desc);
```

### 5. **ä¸‹ä¸€æ­¥å»ºè®®**

ç°åœ¨å¯ä»¥ç»§ç»­å®æ–½ **TODO 3.2ï¼ˆç¼–è¯‘é€‰é¡¹ä¸è¯Šæ–­ï¼‰**ï¼š
- ä¸º CLI å¢åŠ  `--freestanding` é€‰é¡¹
- åœ¨å‘½ä»¤è¡Œé€‰é¡¹ä¸­ä¼ é€’ freestanding æ¨¡å¼æ ‡å¿—
- ç¡®ä¿ freestanding æ¨¡å¼ä¸‹ç¦æ­¢é“¾æ¥å®¿ä¸» OS è¿è¡Œæ—¶

æ‰€æœ‰ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒï¼ˆ4 ç©ºæ ¼ç¼©è¿›ã€ä¸­æ–‡æ³¨é‡Šã€æ¨¡å—åŒ–è®¾è®¡ï¼‰ï¼Œæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ ğŸš€