
### 实现概览（对应 1.3 的三条 TODO）

- **1.3.1 定义 freestanding 编译模式标志**

  - 在 `include/cnlang/support/config.h` 中新增了编译模式枚举 **`CnCompileMode`**：
    - `CN_COMPILE_MODE_HOSTED`：普通宿主环境（默认）。
    - `CN_COMPILE_MODE_FREESTANDING`：freestanding / OS 开发场景。
  - 在 [ir.h](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/include/cnlang/ir/ir.h) 的 **`CnIrModule`** 中新增字段：
    - `CnTargetTriple target;`
    - `CnCompileMode compile_mode; // 宿主 / freestanding`
  - 在 [ir.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/ir/core/ir.c) 的 **`cn_ir_module_new`** 中：
    - 继续把 `module->target` 清零；
    - 新增初始化：`module->compile_mode = CN_COMPILE_MODE_HOSTED;`，默认宿主模式。

- **1.3.2 为 freestanding 目标提供默认编译选项**

  - 在 [irgen.h](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/include/cnlang/ir/irgen.h) / [irgen.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/ir/gen/irgen.c) 中，将 IR 生成入口改为：
    - `CnIrModule *cn_ir_gen_program(CnAstProgram *program, CnTargetTriple target, CnCompileMode mode);`
    - 并在实现中同时写入 `ctx->module->target` 与 `ctx->module->compile_mode`。
  - 在 [cnc/main.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/cli/cnc/main.c) 中：
    - 新增 CLI 选项变量：`bool freestanding_mode = false;`
    - 在用法与 `--help` 输出中，增加说明：
      - `--freestanding  启用 freestanding 编译模式（最小运行时/OS 开发场景）`
    - 参数解析中新增分支：
      - `--freestanding` 时设置 `freestanding_mode = true;`，并开启 `run_pipeline`。
    - 调用 IR 生成改为：
      - `cn_ir_gen_program(program, target_triple, freestanding_mode ? CN_COMPILE_MODE_FREESTANDING : CN_COMPILE_MODE_HOSTED);`
  - 外部 C 编译命令部分（`main.c` 底部）：
    - 在构造 `extra_flags` 时，如果启用 freestanding 且编译器不是 `cl`，追加：
      - `-ffreestanding`
    - 并留有 TODO 注释：后续可根据目标追加 `-nostdlib` / `-nostartfiles` 等更激进的选项，但当前不影响现有测试。

- **1.3.3 C 后端根据编译模式接入配置**

  - 在 [cgen.c](file:///c:/Users/ChenChao/Documents/gitcode/CN_Language/src/backend/cgen/cgen.c) 中的 **`cn_cgen_module_to_file`**：
    - 之前已根据 `module->target` 通过 `cn_support_target_get_data_layout` 缓存了 `g_target_layout`。
    - 本次增加了对 `module->compile_mode` 的使用，用以调整生成的 C 代码头部：
      - 若 `compile_mode == CN_COMPILE_MODE_FREESTANDING`：
        - 只输出：`#include <stdbool.h>\n#include <stdint.h>\n#include "cnrt.h"\n\n`
      - 否则（宿主模式，默认）：
        - 保持原行为：`#include <stdio.h>\n#include <stdbool.h>\n#include <stdint.h>\n#include "cnrt.h"\n\n`
    - 这相当于在 C 代码生成阶段接入了“编译模式”配置，为后续 freestanding 运行时去掉 stdio 等奠定基础。

### 构建与测试情况

- 在 `build` 目录下重新执行了：
  - `cmake --build . --config Debug`
  - `ctest -C Debug -R integration_compile_full_test -V`
- 所有集成编译测试（包括 `runtime_full_test` 和 `--target=x86_64-elf` 场景）均 **通过**，说明新增的 `CnCompileMode`、`--freestanding` 以及 C 后端分支不会影响现有流程。  
- 目前 `--freestanding` 模式的行为已经“接好线”，但暂未引入破坏性链接选项；后续你在阶段 5 的后半部分可以进一步强化（例如真正启用 `-nostdlib`、自定义入口符号、无 `stdio` 的运行时等）。