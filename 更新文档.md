
我已完成 **阶段 3 TODO 列表** 中关于 **AST 到 IR 转换 (Lowering)** 的全部任务。

### 已完成的工作：

1.  **创建 IR 生成模块**：
    *   新建 `include/cnlang/ir/irgen.h` 头文件，定义 `CnIrGenContext` 上下文结构和主要接口
    *   新建 `src/ir/gen/irgen.c` 实现文件（约 389 行）

2.  **表达式转换规则**：
    | AST 节点类型 | IR 生成逻辑 |
    |------------|-----------|
    | 整数字面量 | 立即数 (`CN_IR_OP_IMM_INT`) |
    | 字符串字面量 | 立即数 (`CN_IR_OP_IMM_STR`) |
    | 标识符 | `LOAD` 指令从符号加载到寄存器 |
    | 二元运算 | `ADD`/`SUB`/`MUL`/`DIV`/`EQ`/`NE`/... |
    | 赋值表达式 | `STORE` 指令存入目标地址 |
    | 逻辑表达式 | 短路求值：`BRANCH` + 多基本块 |
    | 一元表达式 | `NEG`/`NOT` 指令 |
    | 函数调用 | `CALL` 指令 + 参数列表 |

3.  **语句与控制流转换**：
    | 语句类型 | IR 生成逻辑 |
    |--------|-----------|
    | 变量声明 | `ALLOCA` + 可选 `STORE` |
    | if 语句 | `BRANCH` + then/else/merge 基本块 |
    | while 循环 | cond/body/exit 基本块 + `BRANCH`/`JUMP` |
    | for 循环 | init + cond/body/update/exit 基本块 |
    | break/continue | `JUMP` 到 loop_exit/loop_continue |
    | return 语句 | `RET` 指令 |

4.  **函数定义转换**：
    *   创建 `CnIrFunction`，处理参数列表
    *   创建入口基本块 `entry`
    *   递归生成函数体内所有语句的 IR

### 更新后的 TODO 状态：

```markdown
#### 2. AST 到 IR 的转换 (Lowering)
- [x] **表达式转换规则**：实现算术、逻辑、赋值等表达式到 IR 指令的生成逻辑。
- [x] **语句与控制流转换**：实现 `if`、`while`、`for` 等控制流语句到 IR 跳转指令的转换。
- [x] **函数定义转换**：处理函数参数、局部变量作用域及返回值的 IR 生成。
```

**下一步建议**：
接下来可以选择：
1. 实现 **IR 优化 Pass**（常量折叠、死代码删除等）
2. 直接开始 **C 后端代码生成**（将 IR 转换为 C 代码）

需要我继续进行哪个任务？